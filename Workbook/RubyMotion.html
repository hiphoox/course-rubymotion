<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.8" />
<title>Programming RubyMotion</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Helvetica,sans-serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: #880009;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: #880009;
}

strong {
  font-weight: bold;
  color: #880009;
}

h1, h2, h3, h4, h5, h6 {
  color: #880009;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1 {
  border-bottom: 1px solid #dddddd;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
  color: #666666;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #4f4f4f; }
ul > li > * { color: #666666; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}


#author {
  color: #880009;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
  color: #666666;
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
  color: #666666;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding:: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #4f4f4f;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1.5px solid #dddddd;
  background: #f4f4f4;
  padding: 0.5em;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  border-radius: 5px;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #f2f2f2;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #666666;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
  color: #4f4f4f;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid red;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}

/*
  pygmentize filter
*/
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f4f4f4; }
.highlight .c { color: #008800; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #AA22FF; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #008800; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #008800 } /* Comment.Preproc */
.highlight .c1 { color: #008800; font-style: italic } /* Comment.Single */
.highlight .cs { color: #008800; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #AA22FF; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #AA22FF; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #AA22FF; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #AA22FF } /* Keyword.Pseudo */
.highlight .kr { color: #AA22FF; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #00BB00; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BB4444 } /* Literal.String */
.highlight .na { color: #BB4444 } /* Name.Attribute */
.highlight .nb { color: #AA22FF } /* Name.Builtin */
.highlight .nc { color: #0000FF } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #00A000 } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #B8860B } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BB4444 } /* Literal.String.Backtick */
.highlight .sc { color: #BB4444 } /* Literal.String.Char */
.highlight .sd { color: #BB4444; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BB4444 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BB4444 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BB4444 } /* Literal.String.Single */
.highlight .ss { color: #B8860B } /* Literal.String.Symbol */
.highlight .bp { color: #AA22FF } /* Name.Builtin.Pseudo */
.highlight .vc { color: #B8860B } /* Name.Variable.Class */
.highlight .vg { color: #B8860B } /* Name.Variable.Global */
.highlight .vi { color: #B8860B } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */



</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Programming RubyMotion</h1>
<span id="author">Norberto Ortigoza</span><br />
<span id="revnumber">version 0.1,</span>
<span id="revdate">Oct 01, 2012</span>
</div>
<div id="content">
<h1 id="_day_1">Day 1</h1>
<h1 id="_chapter_02_first_application">Chapter 02 - First Application</h1>
<div class="sect1">
<h2 id="_time_zone_converter_app">Time Zone Converter App</h2>
<div class="sectionbody">
<div class="paragraph"><p>It is time to create a new Ruby Motion app for doing time zone conversions, run the following command in your terminal:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>motion create TimeZoneConverter
</pre></div></div></div>
<div class="paragraph"><p>And then take a look inside</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>TimeZoneConverter

<span class="nv">$ </span>ls
</pre></div></div></div>
<div class="paragraph"><p>You will see the following directories created</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Rakefile app resources spec</code></pre>
</div></div>
<div class="paragraph"><p>Now feel free to execute the following command:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>rake
</pre></div></div></div>
<div class="paragraph"><p>If everything goes well, you will see an ugly black window.</p></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch02-FirstApplication/image1.png" alt="Empty Application" />
</div>
<div class="title">Figure 1. Empty Application</div>
</div>
<div class="sect2">
<h3 id="_view_controller">View Controller</h3>
<div class="paragraph"><p>A view controller class provides a quite utile mechanism to manage views in iOS applications; it could coordinate efforts with the model and other view controllers in order to build an entire application.</p></div>
</div>
<div class="sect2">
<h3 id="_adding_a_view_controller">Adding a View Controller</h3>
<div class="paragraph"><p>Open your file <strong>app_delegate.rb</strong> in app folder. And add the code between starts in it:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">AppDelegate</span>

 <span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span><span class="ss">:launchOptions</span><span class="p">)</span>
    <span class="o">****************************************************************</span>
    <span class="vi">@window</span> <span class="o">=</span> <span class="no">UIWindow</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">UIScreen</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
    <span class="vi">@window</span><span class="o">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="no">RootViewController</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
    <span class="vi">@window</span><span class="o">.</span><span class="n">makeKeyAndVisible</span>
    <span class="o">****************************************************************</span>
    <span class="kp">true</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Now create a new file named <strong>root_view_controller.rb</strong> in app folder and add the following code:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">RootViewController</span> <span class="o">&lt;</span> <span class="no">UIViewController</span>

  <span class="k">def</span> <span class="nf">viewDidLoad</span>
    <span class="n">view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">scrollViewTexturedBackgroundColor</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Save your file and run the rake command:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>rake
</pre></div></div></div>
<div class="paragraph"><p>You should see a gray styled view, congratulations you have added your first View Controller, it wasn&#8217;t really that hard, was it?</p></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch02-FirstApplication/image2.png" alt="View Controller Added" />
</div>
<div class="title">Figure 2. View Controller Added</div>
</div>
<div class="paragraph"><p>It’s time to create our human interface controls, create a new file named <strong>root_view_uitilities.rb</strong> and add the following code:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">location_label</span><span class="p">(</span><span class="n">xPosition</span><span class="p">,</span><span class="n">yPosition</span><span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="n">xPosition</span><span class="p">,</span><span class="n">yPosition</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>
  <span class="n">label</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span><span class="p">;</span>
  <span class="n">label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;HelveticaNeue-CondensedBold&quot;</span><span class="p">,</span><span class="n">size</span><span class="p">:</span><span class="mi">18</span><span class="p">)</span>
  <span class="n">label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Time Zone&quot;</span>
  <span class="n">label</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">time_label</span><span class="p">(</span><span class="n">xPosition</span><span class="p">,</span><span class="n">yPosition</span><span class="p">)</span>

  <span class="n">label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="n">xPosition</span><span class="p">,</span><span class="n">yPosition</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>
  <span class="n">label</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span><span class="p">;</span>
  <span class="n">label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Time&quot;</span>
  <span class="n">label</span><span class="o">.</span><span class="n">textColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">whiteColor</span><span class="p">;</span>
  <span class="n">label</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">select_time_zone_Button</span> <span class="p">(</span><span class="n">xPosition</span><span class="p">,</span><span class="n">yPosition</span><span class="p">)</span>

  <span class="n">button</span> <span class="o">=</span> <span class="no">UIButton</span><span class="o">.</span><span class="n">buttonWithType</span><span class="p">(</span><span class="no">UIButtonTypeRoundedRect</span><span class="p">)</span>
  <span class="n">button</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="no">CGRectMake</span><span class="p">(</span><span class="n">xPosition</span><span class="p">,</span><span class="n">yPosition</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>
  <span class="n">button</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Select&quot;</span><span class="p">,</span><span class="n">forState</span><span class="ss">:UIControlStateNormal</span><span class="p">)</span>
  <span class="n">button</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">zone_picker</span> <span class="p">(</span><span class="n">xPosition</span><span class="p">,</span><span class="n">yPosition</span><span class="p">)</span>

  <span class="n">picker</span> <span class="o">=</span>  <span class="no">UIPickerView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="n">xPosition</span><span class="p">,</span><span class="n">yPosition</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">250</span><span class="p">))</span>
  <span class="n">picker</span><span class="o">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="n">picker</span><span class="o">.</span><span class="n">showsSelectionIndicator</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="n">picker</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Save your file and compile the project to see if everything goes well, and then open the file <strong>root_view_controller.rb</strong> We are going to add our controls, add the code between the starts in it:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">RootViewController</span> <span class="o">&lt;</span> <span class="no">UIViewController</span>

<span class="o">****************************************************************</span>
  <span class="k">def</span> <span class="nf">set_default_time_zone</span>

    <span class="vi">@defaultTimeZoneLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span>  <span class="no">NSTimeZone</span><span class="o">.</span><span class="n">localTimeZone</span><span class="o">.</span><span class="n">name</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">set_default_time</span>

    <span class="n">defaultTimeZone</span> <span class="o">=</span> <span class="no">NSTimeZone</span><span class="o">.</span><span class="n">timeZoneWithName</span><span class="p">(</span><span class="vi">@defaultTimeZoneLabel</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="no">NSDateFormatter</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
    <span class="n">formatter</span><span class="o">.</span><span class="n">setDateFormat</span><span class="p">(</span><span class="s1">&#39;HH:mm&#39;</span><span class="p">)</span>
    <span class="n">formatter</span><span class="o">.</span><span class="n">setTimeZone</span><span class="p">(</span><span class="n">defaultTimeZone</span><span class="p">)</span>
    <span class="n">dateFormat</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">.</span><span class="n">stringFromDate</span><span class="p">(</span><span class="no">NSDate</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
    <span class="vi">@defaultTimeLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;UTC &quot;</span><span class="o">+</span><span class="p">(</span><span class="no">NSTimeZone</span><span class="o">.</span><span class="n">localTimeZone</span><span class="o">.</span><span class="n">secondsFromGMT</span><span class="o">/</span><span class="mi">3600</span><span class="p">)</span><span class="o">.</span><span class="n">to_s</span> <span class="o">+</span> <span class="s2">&quot;  &quot;</span><span class="o">+</span><span class="n">dateFormat</span>
  <span class="k">end</span>
<span class="o">****************************************************************</span>

  <span class="k">def</span> <span class="nf">viewDidLoad</span>
<span class="o">****************************************************************</span>
    <span class="vi">@defaultTimeZoneLabel</span> <span class="o">=</span> <span class="n">location_label</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span>
    <span class="vi">@defaultTimeLabel</span> <span class="o">=</span> <span class="n">time_label</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span>

    <span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@defaultTimeZoneLabel</span><span class="p">)</span>
    <span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@defaultTimeLabel</span><span class="p">)</span>

    <span class="n">set_default_time_zone</span>
    <span class="n">set_default_time</span>
<span class="o">****************************************************************</span>
    <span class="n">view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">scrollViewTexturedBackgroundColor</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Run your program and you should see two new labels added to the screen, the first one indicates the current timezone name, and the second one the current time.</p></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch02-FirstApplication/image3.png" alt="Controls Added" />
</div>
<div class="title">Figure 3. Controls Added</div>
</div>
<div class="paragraph"><p>Let stop one moment right here, to see the properties of the "UILabel" that we just added, without exit hold ‘command’ key and hover mouse on simulator screen. You can see a red-bordered box appears among the application elements, select the first Time Zone area, the interactive console should display the instance corresponding to that label.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(#&lt;UILabel:0x9447e60&gt;)&gt;</code></pre>
</div></div>
<div class="paragraph"><p>And then explore the text property of the UILabel</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(#&lt;UILabel:0x9447e60&gt;)&gt; self.text</code></pre>
</div></div>
<div class="paragraph"><p>It should return a string</p></div>
<div class="listingblock">
<div class="content">
<pre><code>=&gt; "America/Mexico_City"</code></pre>
</div></div>
<div class="paragraph"><p>Let&#8217;s say that we are extreme curious and we want to know the class of the "text" property from UILabel</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(#&lt;UILabel:0x9447e60&gt;)&gt; self.text.class
=&gt; String</code></pre>
</div></div>
<div class="paragraph"><p>As we may expect its a String, but now what if we want to know the superclass of the "text" property from UILabel</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(#&lt;UILabel:0x9447e60&gt;)&gt; self.text.superclass
=&gt; NSMutableString</code></pre>
</div></div>
<div class="paragraph"><p>Now what if we look for the "String" ancestors, type the following:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(#&lt;UILabel:0x9447e60&gt;)&gt; String.ancestors</code></pre>
</div></div>
<div class="paragraph"><p>What are those classes that appears? Yes you are right those are from the Cocoa Framework</p></div>
<div class="listingblock">
<div class="content">
<pre><code>=&gt; [String, NSMutableString, NSString, Comparable, NSObject, Kernel]</code></pre>
</div></div>
<div class="paragraph"><p>We also can see the available methods, type the following in your terminal</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(#&lt;UILabel:0x9447e60&gt;)&gt; methods</code></pre>
</div></div>
<div class="paragraph"><p>Well, you can see many of them, but yes we can use grep, to find something more specific</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(#&lt;UILabel:0x9447e60&gt;)&gt; methods.grep(/class/)</code></pre>
</div></div>
<div class="paragraph"><p>If you want to return to the main session, you can enter the following command:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(#&lt;UILabel:0x9591580&gt;)&gt; quit</code></pre>
</div></div>
<div class="paragraph"><p>Type self, so you can be sure that you are in the main session:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(main)&gt; self
=&gt; main
(main)&gt;</code></pre>
</div></div>
<div class="paragraph"><p>So far we have discovered some interesting things, also we can find the instance variables of our RootViewController</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(main)&gt; RootViewController.instance_variables
=&gt; [:__classpath__]</code></pre>
</div></div>
<div class="paragraph"><p>And of course we can find out all the elements of the application</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(main)&gt; UIApplication.sharedApplication.keyWindow.rootViewController.view.subviews
=&gt; [#&lt;UILabel:0x95448e0&gt;, #&lt;UILabel:0x9544c30&gt;, #&lt;UIButton:0x9545110&gt;, #&lt;UILabel:0x9537eb0&gt;</code></pre>
</div></div>
<div class="paragraph"><p>and then recursive elements:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>(main)&gt; UIApplication.sharedApplication.keyWindow.recursiveDescription</code></pre>
</div></div>
<div class="paragraph"><p>You can use include of the arrays to ask if a method exists</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[].methods.include? :[]</code></pre>
</div></div>
<div class="paragraph"><p>And also to ask for and Objetive-C Method</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[].methods.include?(:'objectAtIndex:')</code></pre>
</div></div>
<div class="paragraph"><p>It’s time to add a control that let us select from different time zones, open the <strong>root_view_controller.rb</strong> and add the code the following code to it:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">RootViewController</span> <span class="o">&lt;</span> <span class="no">UIViewController</span>

  <span class="k">def</span> <span class="nf">set_default_time_zone</span>

    <span class="vi">@defaultTimeZoneLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span>  <span class="no">NSTimeZone</span><span class="o">.</span><span class="n">localTimeZone</span><span class="o">.</span><span class="n">name</span>
  <span class="k">end</span>


  <span class="k">def</span> <span class="nf">set_default_time</span>

    <span class="n">defaultTimeZone</span> <span class="o">=</span> <span class="no">NSTimeZone</span><span class="o">.</span><span class="n">timeZoneWithName</span><span class="p">(</span><span class="vi">@defaultTimeZoneLabel</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="no">NSDateFormatter</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
    <span class="n">formatter</span><span class="o">.</span><span class="n">setDateFormat</span><span class="p">(</span><span class="s1">&#39;HH:mm&#39;</span><span class="p">)</span>
    <span class="n">formatter</span><span class="o">.</span><span class="n">setTimeZone</span><span class="p">(</span><span class="n">defaultTimeZone</span><span class="p">)</span>
    <span class="n">dateFormat</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">.</span><span class="n">stringFromDate</span><span class="p">(</span><span class="no">NSDate</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
    <span class="vi">@defaultTimeLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;UTC &quot;</span><span class="o">+</span><span class="p">(</span><span class="no">NSTimeZone</span><span class="o">.</span><span class="n">localTimeZone</span><span class="o">.</span><span class="n">secondsFromGMT</span><span class="o">/</span><span class="mi">3600</span><span class="p">)</span><span class="o">.</span><span class="n">to_s</span> <span class="o">+</span> <span class="s2">&quot;  &quot;</span><span class="o">+</span><span class="n">dateFormat</span>
  <span class="k">end</span>

 <span class="o">****************************************************************</span>
  <span class="k">def</span> <span class="nf">present_local_zone_picker</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>

    <span class="n">button</span> <span class="o">=</span> <span class="n">sender</span>
    <span class="vi">@zonePicker</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="no">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">244</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">216</span><span class="p">)</span>
    <span class="vi">@currentZoneLabel</span> <span class="o">=</span> <span class="vi">@defaultTimeZoneLabel</span>

    <span class="k">if</span> <span class="vi">@zonePicker</span><span class="o">.</span><span class="n">isHidden</span>
      <span class="vi">@zonePicker</span><span class="o">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="kp">false</span>
      <span class="n">button</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Choose&quot;</span><span class="p">,</span><span class="n">forState</span><span class="ss">:UIControlStateNormal</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="vi">@zonePicker</span><span class="o">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="kp">true</span>
      <span class="n">button</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Select&quot;</span><span class="p">,</span><span class="n">forState</span><span class="ss">:UIControlStateNormal</span><span class="p">)</span>
      <span class="n">set_default_time</span>
    <span class="k">end</span>
  <span class="k">end</span>


<span class="c1"># UIPicker View Controller DataSource</span>

  <span class="k">def</span> <span class="nf">numberOfComponentsInPickerView</span><span class="p">(</span><span class="n">pickerView</span><span class="p">)</span>

    <span class="mi">1</span>
  <span class="k">end</span>


  <span class="k">def</span> <span class="nf">pickerView</span><span class="p">(</span><span class="n">pickerView</span><span class="p">,</span><span class="n">numberOfRowsInComponent</span><span class="ss">:component</span><span class="p">)</span>

    <span class="no">NSTimeZone</span><span class="o">.</span><span class="n">knownTimeZoneNames</span><span class="o">.</span><span class="n">count</span>
  <span class="k">end</span>


<span class="c1"># UIPicker View Controller Delegate</span>

  <span class="k">def</span> <span class="nf">pickerView</span><span class="p">(</span><span class="n">pickerView</span><span class="p">,</span> <span class="n">titleForRow</span><span class="ss">:row</span><span class="p">,</span><span class="n">forComponent</span><span class="ss">:component</span><span class="p">)</span>

    <span class="no">NSTimeZone</span><span class="o">.</span><span class="n">knownTimeZoneNames</span><span class="o">[</span><span class="n">row</span><span class="o">]</span>
  <span class="k">end</span>


  <span class="k">def</span> <span class="nf">pickerView</span><span class="p">(</span><span class="n">pickerView</span><span class="p">,</span> <span class="n">didSelectRow</span><span class="ss">:row</span><span class="p">,</span> <span class="n">inComponent</span><span class="ss">:component</span><span class="p">)</span>

    <span class="vi">@currentZoneLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="no">NSTimeZone</span><span class="o">.</span><span class="n">knownTimeZoneNames</span><span class="o">[</span><span class="n">row</span><span class="o">]</span>
  <span class="k">end</span>


<span class="o">****************************************************************</span>
  <span class="k">def</span> <span class="nf">viewDidLoad</span>

    <span class="vi">@defaultTimeZoneLabel</span> <span class="o">=</span> <span class="n">location_label</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">120</span><span class="p">)</span>
    <span class="vi">@defaultTimeLabel</span> <span class="o">=</span> <span class="n">time_label</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span>

<span class="o">****************************************************************</span>

    <span class="n">chooseLocalButton</span> <span class="o">=</span> <span class="n">select_time_zone_Button</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span><span class="mi">115</span><span class="p">)</span>
    <span class="n">chooseLocalButton</span><span class="o">.</span><span class="n">addTarget</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span>
                                  <span class="n">action</span><span class="p">:</span> <span class="ss">:&#39;present_local_zone_picker:&#39;</span><span class="p">,</span>
                                  <span class="n">forControlEvents</span><span class="ss">:UIControlEventTouchUpInside</span><span class="p">)</span>

    <span class="vi">@zonePicker</span> <span class="o">=</span> <span class="n">zone_picker</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">244</span><span class="p">)</span>
    <span class="vi">@zonePicker</span><span class="o">.</span><span class="n">dataSource</span> <span class="o">=</span> <span class="nb">self</span>
    <span class="vi">@zonePicker</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span>

<span class="o">****************************************************************</span>

    <span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@defaultTimeZoneLabel</span><span class="p">)</span>
    <span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@defaultTimeLabel</span><span class="p">)</span>

<span class="o">****************************************************************</span>

    <span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">chooseLocalButton</span><span class="p">)</span>
    <span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@zonePicker</span><span class="p">)</span>

<span class="o">****************************************************************</span>
    <span class="n">set_default_time_zone</span>
    <span class="n">set_default_time</span>
    <span class="n">view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">scrollViewTexturedBackgroundColor</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Next compile your application; you should see a white big button, don’t hesitate and try it.</p></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch02-FirstApplication/image4.png" alt="UIPicker Added" />
</div>
<div class="title">Figure 4. UIPicker Added</div>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/ch02-FirstApplication/image5.png" alt="UIPicker Selected" />
</div>
<div class="title">Figure 5. UIPicker Added</div>
</div>
<div class="paragraph"><p>Go ahead and look for a region that you may like to be and see the local time on this area.</p></div>
<div class="paragraph"><p>You ‘ll never wonder again what time is it on other side of the planet, but you may think that its not good enough to know the time in one region, two its always better than one. Lets add a second set of controls.</p></div>
<div class="paragraph"><p>First at all open your <strong>root_view_uitilities.rb</strong> file and add the following code in the loadView method.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">viewDidLoad</span>
<span class="o">****************************************************************</span>

  <span class="n">chooseLocalButton</span><span class="o">.</span><span class="n">addTarget</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">action</span><span class="o">::</span><span class="s1">&#39;present_local_zone_picker:&#39;</span><span class="p">,</span>
                                  <span class="n">forControlEvents</span><span class="ss">:UIControlEventTouchUpInside</span><span class="p">)</span>

  <span class="vi">@converTimeZoneLabel</span> <span class="o">=</span>  <span class="n">location_label</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">290</span><span class="p">)</span>
  <span class="vi">@convertTimeLabel</span> <span class="o">=</span> <span class="n">time_label</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">320</span><span class="p">)</span>
  <span class="n">chooseconvertButton</span> <span class="o">=</span> <span class="n">select_time_zone_Button</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span><span class="mi">300</span><span class="p">)</span>

  <span class="n">chooseconvertButton</span><span class="o">.</span><span class="n">addTarget</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="ss">:&#39;present_convert_zone_picker:&#39;</span><span class="p">,</span>
                                                                <span class="n">forControlEvents</span><span class="ss">:UIControlEventTouchUpInside</span><span class="p">)</span>

  <span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@converTimeZoneLabel</span><span class="p">)</span>
  <span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@convertTimeLabel</span><span class="p">)</span>
  <span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">chooseconvertButton</span><span class="p">)</span>

<span class="o">****************************************************************</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Don’t forget to add the following method in the same file:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">present_convert_zone_picker</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>

  <span class="n">button</span> <span class="o">=</span> <span class="n">sender</span>
  <span class="vi">@zonePicker</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="no">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">216</span><span class="p">)</span>
  <span class="vi">@currentZoneLabel</span> <span class="o">=</span> <span class="vi">@converTimeZoneLabel</span>

  <span class="k">if</span> <span class="vi">@zonePicker</span><span class="o">.</span><span class="n">isHidden</span>

    <span class="vi">@zonePicker</span><span class="o">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="kp">false</span>
    <span class="n">button</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Choose&quot;</span><span class="p">,</span><span class="n">forState</span><span class="ss">:UIControlStateNormal</span><span class="p">)</span>

  <span class="k">else</span>

    <span class="vi">@zonePicker</span><span class="o">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="n">button</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Select&quot;</span><span class="p">,</span><span class="n">forState</span><span class="ss">:UIControlStateNormal</span><span class="p">)</span>
    <span class="n">set_Convert_Time</span>

  <span class="k">end</span>

<span class="k">end</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_styling_the_app">Styling the App</h3>
<div class="paragraph"><p>I think that the style of our application does not reflect the adventure spirit that should be; maybe with some little improvements we can change that.</p></div>
<div class="paragraph"><p>Run the application with the rake command</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>rake
</pre></div></div></div>
<div class="paragraph"><p>Now you should see REPL in your console:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>Create ./build/iPhoneSimulator-6.0-Development/TimeZoneConverter.dSYM
Simulate ./build/iPhoneSimulator-6.0-Development/TimeZoneConverter.app
<span class="o">(</span>main<span class="o">)</span>&gt;
</pre></div></div></div>
<div class="paragraph"><p>Now hold ‘command’ key and hover mouse on simulator screen. You can see a red-bordered box appears among the application elements, select the first Time Zone area, the interactive console should display the instance corresponding to that label</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>Build ./build/iPhoneSimulator-6.0-Development
Simulate ./build/iPhoneSimulator-6.0-Development/TimeZoneConverter.app
<span class="o">(</span><span class="c">#&lt;UILabel:0x956a650&gt;)&gt;</span>
</pre></div></div></div>
<div class="paragraph"><p>Now its time to add something fresh to our application as we see it running, yes you read right type the following scrip in you REPL:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nb">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;Noteworthy-Bold&quot;</span><span class="p">,</span><span class="n">size</span><span class="p">:</span><span class="mi">18</span><span class="p">)</span>
</pre></div></div></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch02-FirstApplication/image6.png" alt="UIPicker Added" />
</div>
<div class="title">Figure 6. UIPicker Added</div>
</div>
<div class="paragraph"><p>and hit enter, and Voila !! the font has changed, but you may not liked, so try with different fonts and sizes here there are some of them:</p></div>
<div class="ulist"><ul>
<li>
<p>
Georgia-Italic
</p>
</li>
<li>
<p>
MarkerFelt-Thin
</p>
</li>
<li>
<p>
HelveticaNeue-Medium
</p>
</li>
</ul></div>
<div class="paragraph"><p>Since the creation of the apple store the are many app to choose from, the app store it’s not the wild wild west that used to be, so we are going to give some personality to our app</p></div>
<div class="paragraph"><p>First, copy the assets from the chapter one directory, and put them into the Resources directory, and the in your <strong>root_view_controller.rb</strong> change the following line in your <strong>viewDidLoad</strong> method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">scrollViewTexturedBackgroundColor</span>
</pre></div></div></div>
<div class="paragraph"><p>for this one:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithPatternImage</span><span class="p">(</span><span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span><span class="s2">&quot;bgApp.png&quot;</span><span class="p">))</span>
</pre></div></div></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch02-FirstApplication/image7.png" alt="Stylish App" />
</div>
<div class="title">Figure 7. Stylish App</div>
</div>
<div class="paragraph"><p>We should add some personality to our buttons, open your file <strong>root_view_uitilities.rb</strong> and replace the following method <strong>select_time_zone_Button</strong>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">select_time_zone_Button</span> <span class="p">(</span><span class="n">xPosition</span><span class="p">,</span><span class="n">yPosition</span><span class="p">)</span>

  <span class="n">button</span> <span class="o">=</span> <span class="no">UIButton</span><span class="o">.</span><span class="n">buttonWithType</span><span class="p">(</span><span class="no">UIButtonTypeCustom</span><span class="p">)</span>
  <span class="n">button</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="no">CGRectMake</span><span class="p">(</span><span class="n">xPosition</span><span class="p">,</span><span class="n">yPosition</span><span class="p">,</span><span class="mi">85</span><span class="p">,</span><span class="mi">73</span><span class="p">)</span>
  <span class="n">button</span><span class="o">.</span><span class="n">setBackgroundImage</span> <span class="p">(</span><span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span><span class="s2">&quot;btnSelect.png&quot;</span><span class="p">),</span><span class="n">forState</span><span class="ss">:UIControlStateNormal</span><span class="p">)</span>
  <span class="n">button</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Select&quot;</span><span class="p">,</span><span class="n">forState</span><span class="ss">:UIControlStateNormal</span><span class="p">)</span>
  <span class="n">button</span>
<span class="k">end</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_challenge_adding_a_title">Challenge - Adding a title</h3>
<div class="paragraph"><p>Adding title to the application, try adding a new method in your file <strong>select_time_zone_Button</strong> that return an UILabel and put it as title for the application.</p></div>
</div>
<div class="sect2">
<h3 id="_challenge_hours_between_zones">Challenge - Hours Between Zones</h3>
<div class="paragraph"><p>Add a new label between time zones that indicates the diference between time zones</p></div>
</div>
</div>
</div>
<h1 id="_chapter_03_objective_c">Chapter 03 - Objective C</h1>
<div class="sect1">
<h2 id="_estimator_app">Estimator App</h2>
<div class="sectionbody">
<div class="paragraph"><p>In this exercise we will create an iOS app that exemplify the way many companies in the world estimate their projects, the "Estimator"</p></div>
<div class="sect2">
<h3 id="_create_project">Create Project</h3>
<div class="paragraph"><p>As a first step we will need to create a project, open your terminal application and run the following command:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>motion create estimator
</pre></div></div></div>
<div class="paragraph"><p>If we look at the new folder "Estimator", we will find a couple of new folders: "app", "resources", "spec".</p></div>
<div class="paragraph"><p>Next, lets copy our application images from <strong>(define deploy route)</strong> into the resources folder</p></div>
</div>
<div class="sect2">
<h3 id="_first_run">First Run</h3>
<div class="paragraph"><p>Just to make sure that everything is fine, we can test our new created project by executing the following line</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>estimator

<span class="nv">$ </span>rake
</pre></div></div></div>
<div class="paragraph"><p>This command will compile the project and run it on the simulator, like the following image:</p></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch03-ObjectiveC/FirstRun.png" alt="First Run" />
</div>
<div class="title">Figure 8. First Run</div>
</div>
</div>
<div class="sect2">
<h3 id="_project_view_controller">Project View Controller</h3>
<div class="paragraph"><p>Let&#8217;s start coding our project, first we need to create a new file that will contain our Project View Controller Class</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>app

<span class="nv">$ </span>mkdir controllers

<span class="nv">$ </span><span class="nb">cd </span>controllers

<span class="nv">$ </span>touch project_view_controller.rb
</pre></div></div></div>
<div class="paragraph"><p>Let&#8217;s open it, and add the following lines:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>open project_view_controller.rb
</pre></div></div></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ProjectViewController</span> <span class="o">&lt;</span> <span class="no">UIViewController</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">loadView</span>

    <span class="nb">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="no">UIView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">redColor</span>

  <span class="k">end</span>

<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Next we need to open the "AppDelegate" of the app, and load our controller into the UIWindow. This is done by inserting the following:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> ..

<span class="nv">$ </span>open app_delegate.rb
</pre></div></div></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span><span class="ss">:launchOptions</span><span class="p">)</span>

  <span class="c1">#Create an instance of Project View Controller</span>
  <span class="n">project_view_controller</span> <span class="o">=</span> <span class="no">ProjectViewController</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>

  <span class="vi">@window</span> <span class="o">=</span> <span class="no">UIWindow</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">UIScreen</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

  <span class="c1">#Every window has a root view controller from which it will present its view</span>
  <span class="vi">@window</span><span class="o">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="n">project_view_controller</span>
  <span class="vi">@window</span><span class="o">.</span><span class="n">makeKeyAndVisible</span>

  <span class="kp">true</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>This part will load a new instance of our Project View Controller and insert its view into the UIWindow. Please note that the UIWindow receives a controller as rootViewController, instead of a view.</p></div>
<div class="paragraph"><p>If we run the project it should look like the following image:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>rake
</pre></div></div></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch03-ObjectiveC/ProjectViewController.png" alt="Project View Controller" />
</div>
<div class="title">Figure 9. Project View Controller</div>
</div>
</div>
<div class="sect2">
<h3 id="_project_view">Project View</h3>
<div class="paragraph"><p>Next we need to add some controls for the user to select the number of screens of the project, complexity, methodology, etc. For this is required to add the following method to the project_view_controller.rb file:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">layout_view</span>

  <span class="c1"># Initialize a new view for the controller</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="no">UIView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">902</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">902</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">902</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span>

  <span class="c1"># The following is an initialization and add of controls into the view</span>


  <span class="c1"># First create an instance of UIImageView, this control will present an Image into the view</span>
  <span class="c1"># for this case a black header</span>
  <span class="vi">@header_image_view</span> <span class="o">=</span> <span class="no">UIImageView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
  <span class="vi">@header_image_view</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span><span class="s2">&quot;bgHeader.png&quot;</span><span class="p">)</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@header_image_view</span><span class="p">)</span>


  <span class="c1"># Next we create an instance of UILabel, tellling it the position on the screen that</span>
  <span class="c1"># we want it to be drawn. For this we use a c struct called CGFrame</span>
  <span class="vi">@title_label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
  <span class="vi">@title_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Project Estimator&quot;</span>
  <span class="vi">@title_label</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">702</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">702</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">702</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="mo">000</span><span class="p">)</span>
  <span class="vi">@title_label</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span>
  <span class="vi">@title_label</span><span class="o">.</span><span class="n">textAlignment</span> <span class="o">=</span> <span class="no">UITextAlignmentCenter</span>

  <span class="c1"># To specify a custom Font we need to tell the proper name of it and the size that we want</span>
  <span class="vi">@title_label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;AvenirNext-Bold&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="mi">25</span><span class="p">)</span>

  <span class="c1"># Then we add it to the view like this way</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@title_label</span><span class="p">)</span>


  <span class="vi">@number_of_screens_text_field</span> <span class="o">=</span> <span class="no">UITextField</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">45</span><span class="p">))</span>
  <span class="vi">@number_of_screens_text_field</span><span class="o">.</span><span class="n">borderStyle</span> <span class="o">=</span> <span class="no">UITextBorderStyleRoundedRect</span>
  <span class="vi">@number_of_screens_text_field</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span>
  <span class="vi">@number_of_screens_text_field</span><span class="o">.</span><span class="n">keyboardType</span> <span class="o">=</span> <span class="no">UIKeyboardTypeNumbersAndPunctuation</span>
  <span class="vi">@number_of_screens_text_field</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="vi">@number_of_screens_text_field</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span><span class="s2">&quot;bgTextField.png&quot;</span><span class="p">)</span>
  <span class="vi">@number_of_screens_text_field</span><span class="o">.</span><span class="n">borderStyle</span> <span class="o">=</span> <span class="no">UITextBorderStyleNone</span>
  <span class="vi">@number_of_screens_text_field</span><span class="o">.</span><span class="n">placeholder</span> <span class="o">=</span> <span class="s2">&quot;Number of Screens&quot;</span>
  <span class="vi">@number_of_screens_text_field</span><span class="o">.</span><span class="n">textColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">451</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">451</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">451</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span>
  <span class="vi">@number_of_screens_text_field</span><span class="o">.</span><span class="n">textAlignment</span> <span class="o">=</span> <span class="no">UITextAlignmentCenter</span>
  <span class="vi">@number_of_screens_text_field</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;AvenirNextCondensed-DemiBold&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span><span class="mi">25</span><span class="p">)</span>
  <span class="vi">@number_of_screens_text_field</span><span class="o">.</span><span class="n">contentVerticalAlignment</span> <span class="o">=</span> <span class="no">UIControlContentVerticalAlignmentCenter</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@number_of_screens_text_field</span><span class="p">)</span>


  <span class="vi">@complexity_label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
  <span class="vi">@complexity_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Complexity&quot;</span>
  <span class="vi">@complexity_label</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">400</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">400</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">400</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span>
  <span class="vi">@complexity_label</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span>
  <span class="vi">@complexity_label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;AvenirNext-DemiBold&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="mi">20</span><span class="p">)</span>
  <span class="vi">@complexity_label</span><span class="o">.</span><span class="n">textAlignment</span> <span class="o">=</span> <span class="no">UITextAlignmentCenter</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@complexity_label</span><span class="p">)</span>


  <span class="c1"># For the UISegmentedControl to work, we need to pass him the possible values</span>
  <span class="c1"># in this case a NSArray do the trick</span>
  <span class="vi">@complexity_values</span> <span class="o">=</span> <span class="no">NSMutableArray</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
  <span class="vi">@complexity_values</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="s2">&quot;Low&quot;</span><span class="p">)</span>
  <span class="vi">@complexity_values</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="s2">&quot;High&quot;</span><span class="p">)</span>

  <span class="c1"># We create an instance of a UISegmentedControl, setting the allowed values for it</span>
  <span class="vi">@complexity_segmented_control</span> <span class="o">=</span> <span class="no">UISegmentedControl</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithItems</span><span class="p">(</span><span class="vi">@complexity_values</span><span class="p">)</span>
  <span class="vi">@complexity_segmented_control</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="no">CGRectMake</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>


  <span class="c1"># Its not required to set a selected index, but for this example we select the first segment</span>
  <span class="vi">@complexity_segmented_control</span><span class="o">.</span><span class="n">selectedSegmentIndex</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@complexity_segmented_control</span><span class="p">)</span>


  <span class="vi">@outsourced_label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
  <span class="vi">@outsourced_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Outsourced&quot;</span>
  <span class="vi">@outsourced_label</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">400</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">400</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">400</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span>
  <span class="vi">@outsourced_label</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span>
  <span class="vi">@outsourced_label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;AvenirNext-DemiBold&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="mi">20</span><span class="p">)</span>
  <span class="vi">@outsourced_label</span><span class="o">.</span><span class="n">textAlignment</span> <span class="o">=</span> <span class="no">UITextAlignmentCenter</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@outsourced_label</span><span class="p">)</span>


  <span class="vi">@outsourced_values</span> <span class="o">=</span> <span class="no">NSMutableArray</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
  <span class="vi">@outsourced_values</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="s2">&quot;No&quot;</span><span class="p">)</span>
  <span class="vi">@outsourced_values</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="s2">&quot;Yes&quot;</span><span class="p">)</span>

  <span class="vi">@outsourced_segmented_control</span> <span class="o">=</span> <span class="no">UISegmentedControl</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithItems</span><span class="p">(</span><span class="vi">@outsourced_values</span><span class="p">)</span>
  <span class="vi">@outsourced_segmented_control</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="no">CGRectMake</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
  <span class="vi">@outsourced_segmented_control</span><span class="o">.</span><span class="n">selectedSegmentIndex</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@outsourced_segmented_control</span><span class="p">)</span>


  <span class="vi">@methodology_label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">290</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
  <span class="vi">@methodology_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Methodology&quot;</span>
  <span class="vi">@methodology_label</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">400</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">400</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">400</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span>
  <span class="vi">@methodology_label</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span>
  <span class="vi">@methodology_label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;AvenirNext-DemiBold&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="mi">20</span><span class="p">)</span>
  <span class="vi">@methodology_label</span><span class="o">.</span><span class="n">textAlignment</span> <span class="o">=</span> <span class="no">UITextAlignmentCenter</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@methodology_label</span><span class="p">)</span>


  <span class="vi">@methodology_values</span> <span class="o">=</span> <span class="no">NSMutableArray</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
  <span class="vi">@methodology_values</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="s2">&quot;Waterfall&quot;</span><span class="p">)</span>
  <span class="vi">@methodology_values</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="s2">&quot;Agile&quot;</span><span class="p">)</span>

  <span class="vi">@methodology_segmented_control</span> <span class="o">=</span> <span class="no">UISegmentedControl</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithItems</span><span class="p">(</span><span class="vi">@methodology_values</span><span class="p">)</span>
  <span class="vi">@methodology_segmented_control</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="no">CGRectMake</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
  <span class="vi">@methodology_segmented_control</span><span class="o">.</span><span class="n">selectedSegmentIndex</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@methodology_segmented_control</span><span class="p">)</span>

<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Also for this to work, we need to change the loadView method to look as the following:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">loadView</span>

  <span class="n">layout_view</span>

<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Let&#8217;s run the application:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>rake
</pre></div></div></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch03-ObjectiveC/ProjectView.png" alt="Project View" />
</div>
<div class="title">Figure 10. Project View</div>
</div>
<div class="paragraph"><p>The segmented controls does not look that pretty right?, lets customize their apperance adding the following method to the project_view_controller.rb file:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1"># Method to customize the appearance of the UISegmentedControl</span>
<span class="k">def</span> <span class="nf">customize_segmented_control</span>

  <span class="c1"># Lets load the images from their respective files</span>
  <span class="n">segmented_control_normal_background</span> <span class="o">=</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span><span class="s2">&quot;bgSegmentedControlNormal.png&quot;</span><span class="p">)</span>
  <span class="n">segmented_control_selected_background</span> <span class="o">=</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span><span class="s2">&quot;bgSegmentedControlSelected.png&quot;</span><span class="p">)</span>
  <span class="n">segmented_control_separator</span> <span class="o">=</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span><span class="s2">&quot;bgSegmentedControlSeparator.png&quot;</span><span class="p">)</span>


  <span class="c1"># Apply the image for the background when the segment is not selected</span>
  <span class="no">UISegmentedControl</span><span class="o">.</span><span class="n">appearance</span><span class="o">.</span><span class="n">setBackgroundImage</span><span class="p">(</span><span class="n">segmented_control_normal_background</span><span class="p">,</span>
                                                   <span class="n">forState</span><span class="ss">:UIControlStateNormal</span><span class="p">,</span>
                                                   <span class="n">barMetrics</span><span class="p">:</span> <span class="no">UIBarMetricsDefault</span><span class="p">)</span>

  <span class="c1"># Apply the image for the background when the segment is selected</span>
  <span class="no">UISegmentedControl</span><span class="o">.</span><span class="n">appearance</span><span class="o">.</span><span class="n">setBackgroundImage</span><span class="p">(</span><span class="n">segmented_control_selected_background</span><span class="p">,</span>
                                                   <span class="n">forState</span><span class="ss">:UIControlStateSelected</span><span class="p">,</span>
                                                   <span class="n">barMetrics</span><span class="p">:</span> <span class="no">UIBarMetricsDefault</span><span class="p">)</span>


  <span class="c1"># Apply the image for the divider of the control</span>
  <span class="no">UISegmentedControl</span><span class="o">.</span><span class="n">appearance</span><span class="o">.</span><span class="n">setDividerImage</span><span class="p">(</span><span class="n">segmented_control_separator</span><span class="p">,</span>
                                                <span class="n">forLeftSegmentState</span><span class="p">:</span> <span class="no">UIControlStateNormal</span><span class="p">,</span>
                                                <span class="n">rightSegmentState</span><span class="ss">:UIControlStateSelected</span><span class="p">,</span>
                                                <span class="n">barMetrics</span><span class="ss">:UIBarMetricsDefault</span><span class="p">)</span>



  <span class="c1"># Also we need to change the font of the titles, the first step is to load the font into the memory</span>
  <span class="n">segmented_control_title_font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;AvenirNextCondensed-Bold&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span><span class="mi">20</span><span class="p">)</span>


  <span class="c1"># To apply certain visual attributes to Apple&#39;s default controls, we need to use a iOS 5 technology</span>
  <span class="c1"># called Skins. To work with screens we must create a dictionary with the key of the property we want</span>
  <span class="c1"># to change and the proper value</span>
  <span class="n">normal_title_text_attributes</span> <span class="o">=</span> <span class="no">NSMutableDictionary</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
  <span class="n">normal_title_text_attributes</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">segmented_control_title_font</span><span class="p">,</span> <span class="n">forKey</span><span class="ss">:UITextAttributeFont</span><span class="p">)</span>

  <span class="n">normal_title_text_color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">545</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">749</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">349</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">normal_title_text_attributes</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">normal_title_text_color</span><span class="p">,</span> <span class="n">forKey</span><span class="p">:</span> <span class="no">UITextAttributeTextColor</span><span class="p">)</span>

  <span class="n">normal_title_text_attributes</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span><span class="p">,</span> <span class="n">forKey</span><span class="p">:</span> <span class="no">UITextAttributeTextShadowColor</span><span class="p">)</span>

  <span class="c1"># Using Skins you can change the visual properties of all the same kind of controls at the same time,</span>
  <span class="c1"># no matter if they were created on another class or in another excecution time. To archive this</span>
  <span class="c1"># only send the messages to the class</span>
  <span class="c1">#</span>
  <span class="c1"># On the other side if you want only to modify one particular control, the following like will work</span>
  <span class="c1"># on the instance instead of the class</span>
  <span class="no">UISegmentedControl</span><span class="o">.</span><span class="n">appearance</span><span class="o">.</span><span class="n">setTitleTextAttributes</span><span class="p">(</span><span class="n">normal_title_text_attributes</span><span class="p">,</span> <span class="n">forState</span><span class="ss">:UIControlStateNormal</span><span class="p">)</span>



  <span class="n">selected_title_text_attributes</span> <span class="o">=</span> <span class="no">NSMutableDictionary</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
  <span class="n">selected_title_text_attributes</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">segmented_control_title_font</span><span class="p">,</span> <span class="n">forKey</span><span class="ss">:UITextAttributeFont</span><span class="p">)</span>

  <span class="n">selected_title_text_color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">200</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">200</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">200</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">selected_title_text_attributes</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">selected_title_text_color</span><span class="p">,</span> <span class="n">forKey</span><span class="ss">:UITextAttributeTextColor</span><span class="p">)</span>

  <span class="no">UISegmentedControl</span><span class="o">.</span><span class="n">appearance</span><span class="o">.</span><span class="n">setTitleTextAttributes</span><span class="p">(</span><span class="n">selected_title_text_attributes</span><span class="p">,</span> <span class="n">forState</span><span class="ss">:UIControlStateSelected</span><span class="p">)</span>

<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>And also we will need to change our loadView method again, lo look like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">loadView</span>

  <span class="n">customize_segmented_control</span>
  <span class="n">layout_view</span>

<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>This time, if we run the application you should see the following in your simulator:</p></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch03-ObjectiveC/ProjectViewWithCustomSegmentedControls.png" alt="Project View with Custom Segmented Controls" />
</div>
<div class="title">Figure 11. Project View with Custom Segmented Controls</div>
</div>
</div>
<div class="sect2">
<h3 id="_project_model">Project Model</h3>
<div class="paragraph"><p>First create a JSON file to contain all the estimated historical data (Fake one ;):</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>cd..

<span class="nv">$ </span><span class="nb">cd </span>resources

<span class="nv">$ </span>touch historical_data.json
</pre></div></div></div>
<div class="paragraph"><p>Then add the following line to the file:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>open historical_data.json
</pre></div></div></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">{</span>
  <span class="nt">&quot;Complexity&quot;</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="nt">&quot;Low&quot;</span><span class="p">:</span>
    <span class="p">{</span>
      <span class="nt">&quot;TotalEffort&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
      <span class="nt">&quot;Variation&quot;</span><span class="p">:</span> <span class="mi">5</span>
    <span class="p">},</span>

    <span class="nt">&quot;High&quot;</span><span class="p">:</span>
    <span class="p">{</span>
      <span class="nt">&quot;TotalEffort&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
      <span class="nt">&quot;Variation&quot;</span><span class="p">:</span> <span class="mi">20</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nt">&quot;Outsourced&quot;</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="nt">&quot;No&quot;</span><span class="p">:</span>
    <span class="p">{</span>
      <span class="nt">&quot;TotalEffort&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
      <span class="nt">&quot;Variation&quot;</span><span class="p">:</span> <span class="mi">5</span>
    <span class="p">},</span>

    <span class="nt">&quot;Yes&quot;</span><span class="p">:</span>
    <span class="p">{</span>
      <span class="nt">&quot;TotalEffort&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
      <span class="nt">&quot;Variation&quot;</span><span class="p">:</span> <span class="mi">7</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nt">&quot;Methodology&quot;</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="nt">&quot;Waterfall&quot;</span><span class="p">:</span>
    <span class="p">{</span>
      <span class="nt">&quot;TotalEffort&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
      <span class="nt">&quot;Variation&quot;</span><span class="p">:</span> <span class="mi">15</span>
    <span class="p">},</span>

    <span class="nt">&quot;Agile&quot;</span><span class="p">:</span>
    <span class="p">{</span>
      <span class="nt">&quot;TotalEffort&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
      <span class="nt">&quot;Variation&quot;</span><span class="p">:</span> <span class="mi">3</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Now we need a object that make the estimation calculus, this object will be called "Project", let&#8217;s create the file that will contain it:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> ..

<span class="nv">$ </span>mkdir models

<span class="nv">$ </span><span class="nb">cd </span>models

<span class="nv">$ </span>touch project.rb
</pre></div></div></div>
<div class="paragraph"><p>Add the next lines to it:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Project</span>

  <span class="c1">#Constants representing Keys in the JSON</span>
  <span class="no">COMPLEXITY_DATA_KEY</span> <span class="o">=</span> <span class="s1">&#39;Complexity&#39;</span>
  <span class="no">OUTSOURCED_DATA_KEY</span> <span class="o">=</span> <span class="s1">&#39;Outsourced&#39;</span>
  <span class="no">METHODOLOGY_DATA_KEY</span> <span class="o">=</span> <span class="s1">&#39;Methodology&#39;</span>
  <span class="no">TOTAL_EFFORT_DATA_KEY</span> <span class="o">=</span> <span class="s1">&#39;TotalEffort&#39;</span>
  <span class="no">VARIATION_DATA_KEY</span> <span class="o">=</span> <span class="s1">&#39;Variation&#39;</span>

  <span class="kp">attr_accessor</span> <span class="ss">:number_of_screens</span>
  <span class="kp">attr_accessor</span> <span class="ss">:complexity</span>
  <span class="kp">attr_accessor</span> <span class="ss">:outsourced</span>
  <span class="kp">attr_accessor</span> <span class="ss">:methodology</span>

  <span class="kp">attr_reader</span> <span class="ss">:total_effort</span>
  <span class="kp">attr_reader</span> <span class="ss">:variation</span>
  <span class="kp">attr_reader</span> <span class="ss">:delivery_year</span>

<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Great!, Now we need to add the logic to read our JSON File, insert the following method in the class:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">load_historical_estimates</span>

  <span class="c1"># Get the path of our JSON File inside the bundle</span>
  <span class="n">historical_data_file</span>  <span class="o">=</span> <span class="no">NSBundle</span><span class="o">.</span><span class="n">mainBundle</span><span class="o">.</span><span class="n">pathForResource</span><span class="p">(</span><span class="s1">&#39;historical_data&#39;</span><span class="p">,</span> <span class="n">ofType</span><span class="ss">:&#39;json&#39;</span><span class="p">)</span>

  <span class="c1"># For us to load the file, we need to pass a pointer. So if something goes wrong we can print</span>
  <span class="c1"># the error</span>
  <span class="n">error_pointer</span> <span class="o">=</span> <span class="no">Pointer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:object</span><span class="p">)</span>

  <span class="c1"># Lets load the file into a NSData</span>
  <span class="n">historical_data</span> <span class="o">=</span> <span class="no">NSData</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithContentsOfFile</span><span class="p">(</span><span class="n">historical_data_file</span><span class="p">,</span>                                                                   <span class="n">options</span><span class="ss">:NSDataReadingUncached</span><span class="p">,</span>
                                                <span class="n">error</span><span class="ss">:error_pointer</span><span class="p">)</span>

  <span class="k">unless</span> <span class="n">historical_data</span>

    <span class="k">if</span> <span class="n">error_pointer</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">code</span> <span class="o">==</span> <span class="no">NSFileReadNoSuchFileError</span>

      <span class="vg">$stderr</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;Error: Missing File Error&quot;</span>

    <span class="k">else</span>

      <span class="vg">$stderr</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;Error: </span><span class="si">#{</span><span class="n">error_pointer</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">end</span>

    <span class="k">return</span> <span class="kp">nil</span>

  <span class="k">end</span>


  <span class="c1"># Serialize the NSData into something we can work with, in this case a Hash</span>
  <span class="n">historical_estimates</span> <span class="o">=</span> <span class="no">NSJSONSerialization</span><span class="o">.</span><span class="n">JSONObjectWithData</span><span class="p">(</span><span class="n">historical_data</span><span class="p">,</span>
                                                                  <span class="n">options</span><span class="p">:</span> <span class="no">NSDataReadingUncached</span><span class="p">,</span>
                                                                  <span class="n">error</span><span class="p">:</span> <span class="n">error_pointer</span><span class="p">)</span>

  <span class="k">unless</span> <span class="n">historical_estimates</span>

    <span class="vg">$stderr</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;Error: </span><span class="si">#{</span><span class="n">error_pointer</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">return</span> <span class="kp">nil</span>
  <span class="k">end</span>


  <span class="n">historical_estimates</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Now we have read our JSON file, the next thing is to extract the historical data into something we can use to make the calculus. This following methods should be added to the class:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">obtain_historical_complexity</span>

  <span class="vi">@complexity_total_effort</span> <span class="o">=</span> <span class="kp">nil</span>
  <span class="vi">@complexity_variation</span> <span class="o">=</span> <span class="kp">nil</span>

  <span class="n">historical_complexity</span> <span class="o">=</span> <span class="vi">@historical_estimates</span><span class="o">[</span><span class="no">COMPLEXITY_DATA_KEY</span><span class="o">]</span>

  <span class="c1"># We use the user selection as a Key</span>
  <span class="k">unless</span> <span class="n">historical_complexity</span><span class="o">[</span><span class="vi">@complexity</span><span class="o">].</span><span class="n">nil?</span>

    <span class="n">selected_historical_complexity</span> <span class="o">=</span> <span class="n">historical_complexity</span><span class="o">[</span><span class="vi">@complexity</span><span class="o">]</span>

    <span class="vi">@complexity_total_effort</span> <span class="o">=</span> <span class="n">selected_historical_complexity</span><span class="o">[</span><span class="no">TOTAL_EFFORT_DATA_KEY</span><span class="o">]</span>
    <span class="vi">@complexity_variation</span> <span class="o">=</span> <span class="n">selected_historical_complexity</span><span class="o">[</span><span class="no">VARIATION_DATA_KEY</span><span class="o">]</span>
  <span class="k">end</span>
<span class="k">end</span>


<span class="k">def</span> <span class="nf">obtain_historical_outsourced</span>

  <span class="vi">@outsourced_total_effort</span> <span class="o">=</span> <span class="kp">nil</span>
  <span class="vi">@outsourced_variation</span> <span class="o">=</span> <span class="kp">nil</span>

  <span class="n">historical_outsourced</span> <span class="o">=</span> <span class="vi">@historical_estimates</span><span class="o">[</span><span class="no">OUTSOURCED_DATA_KEY</span><span class="o">]</span>

  <span class="c1"># We use the user selection as a Key</span>
  <span class="k">unless</span> <span class="n">historical_outsourced</span><span class="o">[</span><span class="vi">@outsourced</span><span class="o">].</span><span class="n">nil?</span>

    <span class="n">selected_historical_outsourced</span> <span class="o">=</span> <span class="n">historical_outsourced</span><span class="o">[</span><span class="vi">@outsourced</span><span class="o">]</span>

    <span class="vi">@outsourced_total_effort</span> <span class="o">=</span> <span class="n">selected_historical_outsourced</span><span class="o">[</span><span class="no">TOTAL_EFFORT_DATA_KEY</span><span class="o">]</span>
    <span class="vi">@outsourced_variation</span> <span class="o">=</span> <span class="n">selected_historical_outsourced</span><span class="o">[</span><span class="no">VARIATION_DATA_KEY</span><span class="o">]</span>
  <span class="k">end</span>
<span class="k">end</span>


<span class="k">def</span> <span class="nf">obtain_historical_methodology</span>

  <span class="vi">@methodology_total_effort</span> <span class="o">=</span> <span class="kp">nil</span>
  <span class="vi">@methodology_variation</span> <span class="o">=</span> <span class="kp">nil</span>

  <span class="n">historical_methodology</span> <span class="o">=</span> <span class="vi">@historical_estimates</span><span class="o">[</span><span class="no">METHODOLOGY_DATA_KEY</span><span class="o">]</span>

  <span class="c1"># We use the user selection as a Key</span>
  <span class="k">unless</span> <span class="n">historical_methodology</span><span class="o">[</span><span class="vi">@methodology</span><span class="o">].</span><span class="n">nil?</span>

    <span class="n">selected_historical_methodology</span> <span class="o">=</span> <span class="n">historical_methodology</span><span class="o">[</span><span class="vi">@methodology</span><span class="o">]</span>

    <span class="vi">@methodology_total_effort</span> <span class="o">=</span> <span class="n">selected_historical_methodology</span><span class="o">[</span><span class="no">TOTAL_EFFORT_DATA_KEY</span><span class="o">]</span>
    <span class="vi">@methodology_variation</span> <span class="o">=</span> <span class="n">selected_historical_methodology</span><span class="o">[</span><span class="no">VARIATION_DATA_KEY</span><span class="o">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Almost there! Lets add the algorithm to make the calculus, inserting the following methods:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">calculate_total_effort</span>

  <span class="c1"># We add all the possible total effort that the user selected</span>
  <span class="n">total_effort_data</span> <span class="o">=</span> <span class="vi">@complexity_total_effort</span> <span class="o">+</span> <span class="vi">@outsourced_total_effort</span> <span class="o">+</span> <span class="vi">@methodology_total_effort</span>

  <span class="c1"># Generate a random with the minimum value of a half of the total effort</span>
  <span class="n">total_effort</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="n">total_effort_data</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">total_effort_data</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

  <span class="c1"># Calculate the effort plus the number of screens as percentage</span>
  <span class="n">total_effort</span> <span class="o">*</span> <span class="p">((</span><span class="vi">@number_of_screens</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">end</span>


<span class="k">def</span> <span class="nf">calculate_variation</span>

  <span class="c1"># We add all the possible variation that the user selected</span>
  <span class="n">variation_data</span> <span class="o">=</span> <span class="vi">@complexity_variation</span> <span class="o">+</span> <span class="vi">@outsourced_variation</span> <span class="o">+</span> <span class="vi">@methodology_variation</span>

  <span class="nb">rand</span><span class="p">(</span><span class="n">variation_data</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">variation_data</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">end</span>


<span class="k">def</span> <span class="nf">calculate_delivery_year</span>

  <span class="c1"># Calculate the total effort plus the posible variation</span>
  <span class="n">total_effort_with_variation</span> <span class="o">=</span> <span class="vi">@total_effort</span> <span class="o">*</span> <span class="p">(</span><span class="vi">@variation</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>

  <span class="c1"># Transform the hours into working weeks</span>
  <span class="n">total_effort_days</span> <span class="o">=</span> <span class="n">total_effort_with_variation</span> <span class="o">/</span> <span class="mi">8</span>
  <span class="n">total_effort_weeks</span> <span class="o">=</span> <span class="n">total_effort_days</span> <span class="o">/</span> <span class="mi">5</span>


  <span class="c1"># In the following part we add the calculated weeks to the current date</span>
  <span class="n">weekComponent</span> <span class="o">=</span> <span class="no">NSDateComponents</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
  <span class="n">weekComponent</span><span class="o">.</span><span class="n">week</span> <span class="o">=</span> <span class="n">total_effort_weeks</span>

  <span class="n">calendar</span> <span class="o">=</span> <span class="no">NSCalendar</span><span class="o">.</span><span class="n">currentCalendar</span>

  <span class="n">delivery_date</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">dateByAddingComponents</span><span class="p">(</span><span class="n">weekComponent</span><span class="p">,</span>
                                                     <span class="n">toDate</span><span class="p">:</span> <span class="no">NSDate</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                                                     <span class="n">options</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>


  <span class="c1"># Of the resulting date we only need the year, in the following section is extracted</span>
  <span class="n">yearComponent</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="no">NSYearCalendarUnit</span><span class="p">,</span> <span class="n">fromDate</span><span class="p">:</span> <span class="n">delivery_date</span><span class="p">)</span>

  <span class="n">yearComponent</span><span class="o">.</span><span class="n">year</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Last part! A method that will execute the calculus, this method will be called by the Project View Controller:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">estimate</span>

  <span class="vi">@historical_estimates</span> <span class="o">=</span> <span class="n">load_historical_estimates</span>


  <span class="n">obtain_historical_complexity</span>
  <span class="n">obtain_historical_outsourced</span>
  <span class="n">obtain_historical_methodology</span>


  <span class="vi">@total_effort</span> <span class="o">=</span>  <span class="n">calculate_total_effort</span>
  <span class="vi">@variation</span> <span class="o">=</span> <span class="n">calculate_variation</span>
  <span class="vi">@delivery_year</span> <span class="o">=</span> <span class="n">calculate_delivery_year</span>

<span class="k">end</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_project_view_controller_and_project_model">Project View Controller and Project Model</h3>
<div class="paragraph"><p>We need to add a button to execute the estimation process, insert this lines on the button of the <em>layout_view</em> method, in the project_view_controller.rb file:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> ..

<span class="nv">$ </span><span class="nb">cd </span>controllers

<span class="nv">$ </span>open project_view_controller.rb
</pre></div></div></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre> <span class="c1"># This control initialization is radically different from the other ones, this is because</span>
<span class="c1"># UIButton provides different types and styles of buttons. The default one is Rounded Rect</span>
<span class="vi">@estimate_button</span> <span class="o">=</span> <span class="no">UIButton</span><span class="o">.</span><span class="n">buttonWithType</span><span class="p">(</span><span class="no">UIButtonTypeRoundedRect</span><span class="p">)</span>
<span class="vi">@estimate_button</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="no">CGRectMake</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>

<span class="c1"># Sometimes when we work with controls we can change the title or image based on different states of</span>
<span class="c1"># it. (Normal, Selected, Highlighted)</span>
<span class="vi">@estimate_button</span><span class="o">.</span><span class="n">setBackgroundImage</span><span class="p">(</span><span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span><span class="s2">&quot;btnEstimate.png&quot;</span><span class="p">),</span> <span class="n">forState</span><span class="ss">:UIControlStateNormal</span><span class="p">)</span>
<span class="c1">#@estimate_button.setTitle(&quot;Estimate this project&quot;, forState: UIControlStateNormal)</span>

<span class="c1"># Lets tell the button who is going to call and where, when the user touch it</span>
<span class="vi">@estimate_button</span><span class="o">.</span><span class="n">addTarget</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span>
                           <span class="n">action</span><span class="p">:</span> <span class="s2">&quot;estimate_project:&quot;</span><span class="p">,</span>
                           <span class="n">forControlEvents</span><span class="p">:</span> <span class="no">UIControlEventTouchUpInside</span><span class="p">)</span>

<span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@estimate_button</span><span class="p">)</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">The method is called estimate_project:, with the two dots</td>
</tr></table>
</div>
<div class="paragraph"><p>Please pay special attention to the <em>addTarget</em> method, this is used to tell the button who and in which method it should call when the user touches it. In this case we are telling it to call the Project View Controller in the method "estimate_project:", lets add the following:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">estimate_project</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>

  <span class="c1"># Create a new instance of Project</span>
  <span class="n">project</span> <span class="o">=</span> <span class="no">Project</span><span class="o">.</span><span class="n">new</span>

  <span class="n">project</span><span class="o">.</span><span class="n">number_of_screens</span> <span class="o">=</span> <span class="vi">@number_of_screens_text_field</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">intValue</span>


  <span class="c1"># We need the selected index to extract the string value from the segmented allowed</span>
  <span class="c1"># values array</span>
  <span class="n">selected_complexity_index</span> <span class="o">=</span> <span class="vi">@complexity_segmented_control</span><span class="o">.</span><span class="n">selectedSegmentIndex</span>
  <span class="n">project</span><span class="o">.</span><span class="n">complexity</span> <span class="o">=</span> <span class="vi">@complexity_values</span><span class="o">.</span><span class="n">objectAtIndex</span><span class="p">(</span><span class="n">selected_complexity_index</span><span class="p">)</span>


  <span class="n">selected_outsourced_index</span> <span class="o">=</span> <span class="vi">@outsourced_segmented_control</span><span class="o">.</span><span class="n">selectedSegmentIndex</span>
  <span class="n">project</span><span class="o">.</span><span class="n">outsourced</span> <span class="o">=</span> <span class="vi">@outsourced_values</span><span class="o">.</span><span class="n">objectAtIndex</span><span class="p">(</span><span class="n">selected_outsourced_index</span><span class="p">)</span>


  <span class="n">selected_methodology_index</span> <span class="o">=</span> <span class="vi">@methodology_segmented_control</span><span class="o">.</span><span class="n">selectedSegmentIndex</span>
  <span class="n">project</span><span class="o">.</span><span class="n">methodology</span> <span class="o">=</span> <span class="vi">@methodology_values</span><span class="o">.</span><span class="n">objectAtIndex</span><span class="p">(</span><span class="n">selected_methodology_index</span><span class="p">)</span>


  <span class="n">project</span><span class="o">.</span><span class="n">estimate</span>

<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>In this method we implement the creation of a new Project instance, setting the user input and finally we ask it to calculate the estimation</p></div>
</div>
<div class="sect2">
<h3 id="_estimation_view_controller">Estimation View Controller</h3>
<div class="paragraph"><p>Now we need to add some place to show our calculated values, for this we need to create a new view controller called "Estimation View Controller":</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>touch estimation_view_controller.rb
</pre></div></div></div>
<div class="paragraph"><p>Add the following lines to the "estimation_view_controller.rb":</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">EstimationViewController</span> <span class="o">&lt;</span> <span class="no">UIViewController</span>

  <span class="k">def</span> <span class="nf">loadView</span>

    <span class="n">layout_view</span>

  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">layout_view</span>

    <span class="nb">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="no">UIView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">298</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">298</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">298</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span>

    <span class="vi">@header_image_view</span> <span class="o">=</span> <span class="no">UIImageView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
    <span class="vi">@header_image_view</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span><span class="s2">&quot;bgHeader.png&quot;</span><span class="p">)</span>

    <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@header_image_view</span><span class="p">)</span>


    <span class="vi">@title_label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
    <span class="vi">@title_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Estimation&quot;</span>
    <span class="vi">@title_label</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">702</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">702</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">702</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="mo">000</span><span class="p">)</span>
    <span class="vi">@title_label</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span>
    <span class="vi">@title_label</span><span class="o">.</span><span class="n">textAlignment</span> <span class="o">=</span> <span class="no">UITextAlignmentCenter</span>
    <span class="vi">@title_label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;AvenirNext-Bold&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="mi">25</span><span class="p">)</span>

    <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@title_label</span><span class="p">)</span>


    <span class="vi">@total_effort_title_label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
    <span class="vi">@total_effort_title_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Total effort&quot;</span>
    <span class="vi">@total_effort_title_label</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">702</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">702</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">702</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="mo">000</span><span class="p">)</span>
    <span class="vi">@total_effort_title_label</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span>
    <span class="vi">@total_effort_title_label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;AvenirNextCondensed-DemiBold&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="mi">35</span><span class="p">)</span>

    <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@total_effort_title_label</span><span class="p">)</span>


    <span class="vi">@total_effort_value_label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">180</span><span class="p">))</span>
    <span class="vi">@total_effort_value_label</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">whiteColor</span>
    <span class="vi">@total_effort_value_label</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span>
    <span class="vi">@total_effort_value_label</span><span class="o">.</span><span class="n">textAlignment</span> <span class="o">=</span> <span class="no">UITextAlignmentCenter</span>
    <span class="vi">@total_effort_value_label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;AvenirNextCondensed-Bold&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="mi">120</span><span class="p">)</span>
    <span class="vi">@total_effort_value_label</span><span class="o">.</span><span class="n">minimumFontSize</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="vi">@total_effort_value_label</span><span class="o">.</span><span class="n">adjustsFontSizeToFitWidth</span> <span class="o">=</span> <span class="kp">true</span>

    <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@total_effort_value_label</span><span class="p">)</span>


    <span class="vi">@total_effort_unit_label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">70</span><span class="p">))</span>
    <span class="vi">@total_effort_unit_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;HRS&quot;</span>
    <span class="vi">@total_effort_unit_label</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">671</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="mo">000</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">353</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="mo">000</span><span class="p">)</span>
    <span class="vi">@total_effort_unit_label</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span>
    <span class="vi">@total_effort_unit_label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;AvenirNextCondensed-Bold&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="mi">72</span><span class="p">)</span>

    <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@total_effort_unit_label</span><span class="p">)</span>


    <span class="vi">@variation_title_label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
    <span class="vi">@variation_title_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Variation&quot;</span>
    <span class="vi">@variation_title_label</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">702</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">702</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">702</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="mo">000</span><span class="p">)</span>
    <span class="vi">@variation_title_label</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span>
    <span class="vi">@variation_title_label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;AvenirNextCondensed-Bold&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="mi">30</span><span class="p">)</span>

    <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@variation_title_label</span><span class="p">)</span>


    <span class="vi">@variation_value_label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">265</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">85</span><span class="p">))</span>
    <span class="vi">@variation_value_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;52&quot;</span>
    <span class="vi">@variation_value_label</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">whiteColor</span>
    <span class="vi">@variation_value_label</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span>
    <span class="vi">@variation_value_label</span><span class="o">.</span><span class="n">textAlignment</span> <span class="o">=</span> <span class="no">UITextAlignmentCenter</span>
    <span class="vi">@variation_value_label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;AvenirNextCondensed-Bold&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="mi">80</span><span class="p">)</span>

    <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@variation_value_label</span><span class="p">)</span>


    <span class="vi">@variation_unit_label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="mi">190</span><span class="p">,</span> <span class="mi">310</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
    <span class="vi">@variation_unit_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span>
    <span class="vi">@variation_unit_label</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">671</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="mo">000</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">353</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="mo">000</span><span class="p">)</span>
    <span class="vi">@variation_unit_label</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span>
    <span class="vi">@variation_unit_label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;AvenirNextCondensed-Bold&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="mi">50</span><span class="p">)</span>

    <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@variation_unit_label</span><span class="p">)</span>


    <span class="vi">@delivery_year_title_label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">370</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
    <span class="vi">@delivery_year_title_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Delivery year&quot;</span>
    <span class="vi">@delivery_year_title_label</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">702</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">702</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">702</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="o">.</span><span class="mo">000</span><span class="p">)</span>
    <span class="vi">@delivery_year_title_label</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span>
    <span class="vi">@delivery_year_title_label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;AvenirNextCondensed-Bold&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="mi">30</span><span class="p">)</span>

    <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@delivery_year_title_label</span><span class="p">)</span>


    <span class="vi">@delivery_year_value_label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">CGRectMake</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
    <span class="vi">@delivery_year_value_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;2040&quot;</span>
    <span class="vi">@delivery_year_value_label</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">whiteColor</span>
    <span class="vi">@delivery_year_value_label</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span>
    <span class="vi">@delivery_year_value_label</span><span class="o">.</span><span class="n">textAlignment</span> <span class="o">=</span> <span class="no">UITextAlignmentRight</span>
    <span class="vi">@delivery_year_value_label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;AvenirNextCondensed-Bold&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="mi">50</span><span class="p">)</span>

    <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@delivery_year_value_label</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>We just implement the logic for our new view controller, also we add some labels to draw on the screen the values generated by the Project estimation</p></div>
</div>
<div class="sect2">
<h3 id="_estimation_view_controller_and_project_model">Estimation View Controller and Project Model</h3>
<div class="paragraph"><p>The last part of our implementation is to add a way to bind the values of the Project Model into our labels, the following method does the trick (Insert it on the estimation_view_controller.rb):</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1"># Method to bind the values in the Project Object into proper UILabels</span>
<span class="k">def</span> <span class="nf">bind_project</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>

  <span class="c1">#Using an NSString we set the text into the label, when we are using %@ we tell the object</span>
  <span class="c1">#to print it description as a string</span>
  <span class="vi">@total_effort_value_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="no">NSString</span><span class="o">.</span><span class="n">stringWithFormat</span><span class="p">(</span><span class="s2">&quot;%@&quot;</span><span class="p">,</span> <span class="n">project</span><span class="o">.</span><span class="n">total_effort</span><span class="p">)</span>

  <span class="vi">@variation_value_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="no">NSString</span><span class="o">.</span><span class="n">stringWithFormat</span><span class="p">(</span><span class="s2">&quot;%@&quot;</span><span class="p">,</span> <span class="n">project</span><span class="o">.</span><span class="n">variation</span><span class="p">)</span>

  <span class="vi">@delivery_year_value_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="no">NSString</span><span class="o">.</span><span class="n">stringWithFormat</span><span class="p">(</span><span class="s2">&quot;%@&quot;</span><span class="p">,</span> <span class="n">project</span><span class="o">.</span><span class="n">delivery_year</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">Please take note that in this specific case we are using Objective-C strings (NSStrings) instead of ruby strings</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_project_view_controller_and_estimation_view_controller">Project View Controller and Estimation View Controller</h3>
<div class="paragraph"><p>Final task! We need to show our new controller, the way to do this is to perform a transition from the Project View Controller to the Estimation View Controller</p></div>
<div class="paragraph"><p>Insert the following lines into the estimate_project(sender) method on the class project_view_controller.rb:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1"># Now we need a new instance of the Estimation View Controller for show the</span>
<span class="c1"># results of the Project estimation</span>
<span class="vi">@estimation_view_controller</span> <span class="o">=</span> <span class="no">EstimationViewController</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>

<span class="vi">@estimation_view_controller</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">frame</span>

<span class="c1"># Lets tell it to bind our project instance</span>
<span class="vi">@estimation_view_controller</span><span class="o">.</span><span class="n">bind_project</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>


<span class="c1"># To show the Estimation View Controller view, we can use a transition.</span>
<span class="c1"># From our current view, to the Estimation View Controller&#39;s view</span>
<span class="no">UIView</span><span class="o">.</span><span class="n">transitionFromView</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="p">,</span>
                          <span class="n">toView</span><span class="p">:</span> <span class="vi">@estimation_view_controller</span><span class="o">.</span><span class="n">view</span><span class="p">,</span>
                          <span class="n">duration</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span>
                          <span class="n">options</span><span class="p">:</span> <span class="no">UIViewAnimationOptionTransitionFlipFromLeft</span><span class="p">,</span>
                          <span class="n">completion</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_run_and_enjoy">Run and Enjoy</h3>
<div class="paragraph"><p>Lets run our estimator app!</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>rake
</pre></div></div></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch03-ObjectiveC/FinishedProjectViewController.png" alt="Finished Project View Controller" />
</div>
<div class="title">Figure 12. Finished Project View Controller</div>
</div>
<div class="imageblock">
<div class="content">
<img src="resources/ch03-ObjectiveC/FinishedEstimationViewController.png" alt="Finished Estimation View Controller" />
</div>
<div class="title">Figure 13. Finished Estimation View Controller</div>
</div>
</div>
<div class="sect2">
<h3 id="_challenges">Challenges</h3>
<div class="paragraph"><p>1.- The UISegmentedControlls in the project_view_controller.rb are bound to a static array, move that logic to the Project Model. So it can provide the allowed values for the estimation.</p></div>
<div class="paragraph"><p>2.- Now that the allowed values are in the Project Model, lets make it dynamic by retrieving them from the JSON File.</p></div>
</div>
</div>
</div>
<h1 id="_chapter_05_cocoa_overview">Chapter 05 - Cocoa Overview</h1>
<div class="sect1">
<h2 id="_the_cocoaheads_app">The Cocoaheads app</h2>
<div class="sectionbody">
<div class="paragraph"><p>Cocoaheads is a community of OSX/iOS programmers. There are many Cocoaheads communities around the world and they meet periodically (normally on a monthly basis) to discuss the latest topics for Apple-related technologies.</p></div>
<div class="paragraph"><p>We want to build an iPhone app for this community. The app should cover the next functionality:</p></div>
<div class="ulist"><ul>
<li>
<p>
Show the complete schedule for the next Cocoaheads meetings.
</p>
</li>
<li>
<p>
Show the information about the next meeting. This information could include the map to the venue, the list of the talks, etc.
</p>
</li>
<li>
<p>
Registration and login of users.
</p>
</li>
<li>
<p>
Allow users to register for the next meeting.
</p>
</li>
</ul></div>
<div class="paragraph"><p>We are going to build this app for several chapters, one step a time. In this chapter we are going to focus in creating the first screen: the Next Event screen that shows the information related to the next meeting:</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch05-CocoaOverview/ch05_01_app.png" alt="Chapter 5 app" />
</span></p></div>
<div class="sect2">
<h3 id="_creating_the_app">Creating the app</h3>
<div class="paragraph"><p>Let&#8217;s start by creating the Cocoaheads rubymotion app. You have already know how to create RubyMotion apps from previous chapters, in the command line type:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>motion create Cocoaheads
</pre></div></div></div>
<div class="paragraph"><p>As we have seen, this command creates an empty application with the following folder structure:</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch05-CocoaOverview//ch05_02_folder_structure.png" alt="Folder structure" />
</span></p></div>
<div class="paragraph"><p>We&#8217;ll be using a structure based on Rails for this Course. Thus, you need to create a folrder named "controllers" inside the "app" folder. Inside "controllers". create an empty file called "next_event_view_controller.rb".</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch05-CocoaOverview//ch05_03_folder_controllers.png" alt="Controllers folder" />
</span></p></div>
<div class="paragraph"><p>As we have seen in previous chapters, the vanilla app created by the motion command only creates an empty app. We need to add a Window to it. Thus, open the app_delegate.rb class and inside the method</p></div>
<div class="paragraph"><p>copy this code:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span><span class="ss">:launchOptions</span><span class="p">)</span>

  <span class="n">next_event_view_controller</span> <span class="o">=</span> <span class="no">NextEventViewController</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
  <span class="vi">@window</span> <span class="o">=</span> <span class="no">UIWindow</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">UIScreen</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>
  <span class="vi">@window</span><span class="o">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="n">next_event_view_controller</span>
  <span class="vi">@window</span><span class="o">.</span><span class="n">makeKeyAndVisible</span>
  <span class="kp">true</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Remember that this method is called once iOS has finished creating your app. In that moment, the <strong>UIAppDelegate</strong> is notified using this method so you can initiliaze the app.</p></div>
<div class="paragraph"><p>This is what we are doing inside the method:</p></div>
<div class="ulist"><ul>
<li>
<p>
Create a <strong>UIWindow</strong>.
</p>
</li>
<li>
<p>
Assigning a <strong>UIViewController</strong> as the <strong>rootViewController</strong> of the window.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Notice that we are creating the <strong>UIWindow</strong> with the same Frame as <strong>UIScreen.mainScreen</strong>. <strong>UIScreen</strong> is a convenient class to access the size of a screen device. So basically we are setting the size of the app&#8217;s window to be the full screen.</p></div>
</div>
<div class="sect2">
<h3 id="_creating_the_view_controller">Creating the View Controller</h3>
<div class="paragraph"><p>Now, we are going  create our View Controller. Open the <strong>next_event_view_controller.rb</strong> file and create a child of UIViewController:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">NextEventViewController</span> <span class="o">&lt;</span> <span class="no">UIViewController</span>

  <span class="k">def</span> <span class="nf">init</span>

    <span class="nb">p</span> <span class="s1">&#39;Initializing NextEventViewController&#39;</span>
    <span class="k">super</span>
    <span class="nb">self</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">loadView</span>

    <span class="nb">p</span> <span class="s1">&#39;loading view&#39;</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="no">UIView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>In Cocoa, there is no <strong>initialize</strong> metod. There is the <strong>init</strong> method with the responsbility of creating the instance of the class. It is mandatory that you call <strong>super</strong> and then, return <strong>self</strong>.</p></div>
<div class="paragraph"><p>The other method we are creating is <strong>loadView</strong>. The responsibility of this method is to actually create the view of this Controller. So we are basically creating a view that covers all the screen and switching its background color to white. <strong>UIColor</strong> is the  class we use in Cocoa to handle colors, it has some convenient class methods with predefined colors (such as <strong>whiteColor</strong>) but it also allows you to create custom colors.</p></div>
<div class="paragraph"><p>Use the command</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>rake
</pre></div></div></div>
<div class="paragraph"><p>to test the application, you will see a white screen. And in the console you will notice that first the init method was invoked and then the loadView.</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch05-CocoaOverview/ch05_04_console.png" alt="Console output" />
</span></p></div>
</div>
<div class="sect2">
<h3 id="_using_uiimageview">Using UIImageView</h3>
<div class="paragraph"><p>Now it&#8217;s time to begin to stylish our app. We are going to add an header and a background image with a nice gradient.</p></div>
<div class="paragraph"><p>Open the zip file called ch05CocoaOverview_resources.zip, inside you&#8217;ll find the Design assets for this workshop. Copy them into the <strong>resources</strong> folder of our app.</p></div>
<div class="paragraph"><p>Now inside our View Controller, add these lines:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">viewDidLoad</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">imageViewWithHeader</span> <span class="p">)</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">imageViewWithBackground</span> <span class="p">)</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">imageViewWithTitleBackground</span> <span class="p">)</span>
<span class="k">end</span>


<span class="k">def</span> <span class="nf">imageViewWithHeader</span>

  <span class="n">header_imageview</span> <span class="o">=</span> <span class="no">UIImageView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithImage</span><span class="p">(</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span><span class="s1">&#39;bgTitleBar&#39;</span><span class="p">)</span> <span class="p">)</span>
  <span class="n">header_imageview</span>
<span class="k">end</span>


<span class="k">def</span> <span class="nf">imageViewWithBackground</span>

  <span class="n">background_imageview</span> <span class="o">=</span> <span class="no">UIImageView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithImage</span><span class="p">(</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span><span class="s1">&#39;bgApp&#39;</span><span class="p">)</span> <span class="p">)</span>
  <span class="n">background_imageview</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="no">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">396</span><span class="p">)</span>
  <span class="n">background_imageview</span>
<span class="k">end</span>


<span class="k">def</span> <span class="nf">imageViewWithTitleBackground</span>

  <span class="n">title_background_imageview</span> <span class="o">=</span> <span class="no">UIImageView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithImage</span><span class="p">(</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span><span class="s1">&#39;bgEventTitle&#39;</span><span class="p">)</span> <span class="p">)</span>
  <span class="n">title_background_imageview</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="o">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">103</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">320</span><span class="p">,</span> <span class="mi">103</span><span class="o">]]</span>
  <span class="n">title_background_imageview</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>The method <strong>viewDidLoad</strong> is called once the view of the Controller is loaded into memory. It&#8217;s safe, then, to initialize the view inside this method.</p></div>
<div class="paragraph"><p>Basically, we are adding two images using the <strong>addSubview</strong> method of <strong>UIView</strong>. In the <strong>imageViewWithHeader</strong> method, we are creating the first image: the header image. In CocoaTouch we have the <strong>UIImageView</strong> class to add images to our apps. We are using its initializer method called <strong>initWithImage</strong> that receives a <strong>UIImage</strong>. <strong>UIImage</strong> is the image itself, and <strong>UIImageView</strong> is only a convenient <strong>UIView</strong> that simplifies the process of painting an image on screen.</p></div>
<div class="paragraph"><p><strong>UIImage</strong> can be created with its class method <strong>imageNamed</strong> that receives an <strong>NSString</strong> with the name of the image file.</p></div>
<div class="paragraph"><p>In the <strong>imageViewWithBackground</strong> method we are creating the <strong>UIImageView</strong> with the background image. Notice that we are changing the frame of this image. The frame is a property of type <strong>CGRect</strong> that the class <strong>UIView</strong> uses to specify the location of the view inside its superview and its size.</p></div>
<div class="paragraph"><p>We are using the <strong>CGRectMake</strong> function to create our frame. The first two arguments define the location coordinates of the object from the top left corner of the superview. For the background we are specifying an X coordinate of 0, thus the object will be at the left-most location of the screen; and a Y coordinate of 64, thus the object will be placed below the header image. The second  and third argument specifies its size.</p></div>
<div class="paragraph"><p>RubyMotion has another way to create a <strong>CGRect</strong>. Try to change the <strong>CGRectMake</strong> line to this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">background_imageview</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="o">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">320</span><span class="p">,</span> <span class="mi">396</span><span class="o">]]</span>
</pre></div></div></div>
<div class="paragraph"><p>RubyMotion allow us to use an array of two arrays to define *CGRect*s. The first array specifies the location of the object and the second its size.</p></div>
<div class="paragraph"><p>When you run the app you will something like this:</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch05-CocoaOverview/ch05_05_uiimage.png" alt="Console output" />
</span></p></div>
</div>
<div class="sect2">
<h3 id="_creating_labels">Creating labels</h3>
<div class="paragraph"><p>The next step is to create the labels with the Event information. Add this two methods to your View Controller:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">labelWithNextEventName</span>

  <span class="n">next_event_name_label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span> <span class="o">[[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">130</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">275</span><span class="p">,</span> <span class="mi">40</span><span class="o">]]</span> <span class="p">)</span>

  <span class="n">next_event_name_label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;AmericanTypewriter-CondensedBold&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span><span class="mi">30</span><span class="p">)</span>
  <span class="n">next_event_name_label</span><span class="o">.</span><span class="n">textColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">whiteColor</span>
  <span class="n">next_event_name_label</span><span class="o">.</span><span class="n">textAlignment</span> <span class="o">=</span> <span class="no">UITextAlignmentCenter</span>
  <span class="n">next_event_name_label</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span>
  <span class="n">next_event_name_label</span><span class="o">.</span><span class="n">shadowColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">darkGrayColor</span>
  <span class="n">next_event_name_label</span><span class="o">.</span><span class="n">shadowOffset</span> <span class="o">=</span> <span class="o">[-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span>
  <span class="n">next_event_name_label</span>

<span class="k">end</span>


<span class="k">def</span> <span class="nf">labelWithDaysLeft</span>

  <span class="n">days_left_label</span> <span class="o">=</span> <span class="no">UILabel</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span> <span class="o">[[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">220</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">275</span><span class="p">,</span> <span class="mi">40</span><span class="o">]]</span> <span class="p">)</span>
  <span class="n">days_left_label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;HelveticaNeue-Light&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span><span class="mi">20</span><span class="p">)</span>
  <span class="n">days_left_label</span><span class="o">.</span><span class="n">textColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">whiteColor</span>
  <span class="n">days_left_label</span><span class="o">.</span><span class="n">textAlignment</span> <span class="o">=</span> <span class="no">UITextAlignmentCenter</span>
  <span class="n">days_left_label</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span>
  <span class="n">days_left_label</span><span class="o">.</span><span class="n">shadowColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">darkGrayColor</span>
  <span class="n">days_left_label</span><span class="o">.</span><span class="n">shadowOffset</span> <span class="o">=</span> <span class="o">[-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span>
  <span class="n">days_left_label</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>The object used in CocoaTouch to disply lines of text is <strong>UILabel</strong>. We are creating two <strong>UILabel</strong> using the initializer method <strong>initWithFrame</strong> to specify their size and location.</p></div>
<div class="paragraph"><p>Then, we are changing its font and size. An <strong>UILabel</strong> has a property named <strong>font</strong> that allow us to do that. To create a Font, we are using the <strong>UIFont</strong> class and its method <strong>fontWithName:size</strong>. As you can see, you specify the font using a NSString with the Font Family name. If you want to see the available Fonts in CocoaTouch, try to print the array returned by <strong>UIFont.familyNames</strong>.</p></div>
<div class="paragraph"><p>Next, we are changing the color of the label using the <strong>textColor</strong> property and the text alignment. By default a <strong>UILabel</strong> has a white background color, we are changing this to clearColor. This is a special color to specify transparencies. So, basically we are defining that the background of this <strong>UILabel</strong> should be transparent.</p></div>
<div class="paragraph"><p>Finally, we are adding a shadow to the label. With <strong>shadowColor</strong> you specify its color and with <strong>shadowOffset</strong> its location. This offset is the number of points that the shadow will be offset from the label. It is a <strong>CGSize</strong> object so you can specify it with the <strong>CGSizeMake</strong> function, but we prefer to use the more convenient RubyMotion way of using an array of two elements, one for width and the other one for weight. With <strong>[-1, -1]</strong> we are defining that the shadow will be 1 point offset to the left and 1 point offset up from the label.</p></div>
<div class="paragraph"><p>We have the methods to create our labels, is time to add them to our view. Inside the viewDidLoad method add this lines:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">viewDidLoad</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">imageViewWithHeader</span> <span class="p">)</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">imageViewWithBackground</span> <span class="p">)</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">imageViewWithTitleBackground</span> <span class="p">)</span>

  <span class="vi">@next_event_name_label</span> <span class="o">=</span> <span class="n">labelWithNextEventName</span>
  <span class="vi">@days_left_label</span> <span class="o">=</span> <span class="n">labelWithDaysLeft</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="vi">@next_event_name_label</span> <span class="p">)</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="vi">@days_left_label</span> <span class="p">)</span>

  <span class="vi">@days_left_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="no">DAYS_LEFT_TEXT</span>
  <span class="vi">@next_event_name_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="no">EVENT_NAME_TEXT</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>And create this other method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">viewDidUnload</span>

  <span class="k">super</span>
  <span class="vi">@next_event_name_label</span> <span class="o">=</span> <span class="kp">nil</span>
  <span class="vi">@days_left_label</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>We are adding the labels to instance variables. This is recommended if you need to access them later to change its properties. In this case we are changing the text of the labels to some constants. Finally add this two constants to your View Controller:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">NextEventViewController</span> <span class="o">&lt;</span> <span class="no">UIViewController</span>

  <span class="no">DAYS_LEFT_TEXT</span> <span class="o">=</span> <span class="s2">&quot;(20 Days Left)&quot;</span>
  <span class="no">EVENT_NAME_TEXT</span> <span class="o">=</span> <span class="s2">&quot;November meeting.&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>When you keep <strong>UIView*s in instance variables, it is recommended to set this variables to *nil</strong> inside the <strong>viewDidUnload</strong> method. Prior to iOS 6, this method was invoked when the device was running out of memory. Then, we are freeing the memory allocated for the UILabels for low memory scenarios.</p></div>
<div class="paragraph"><p>Run your app and you should see that the labels appeared with the data for the next Cocoaheads event:</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch05-CocoaOverview/ch05_06_uilabel.png" alt="Labels" />
</span></p></div>
</div>
<div class="sect2">
<h3 id="_adding_buttons">Adding buttons</h3>
<div class="paragraph"><p>Finally, we are going to add two buttons to our app: for sign-up and for sign-in.</p></div>
<div class="paragraph"><p>Add these methods to the View Controller:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">buttonForSignIn</span>

  <span class="n">sign_in_button</span> <span class="o">=</span> <span class="no">UIButton</span><span class="o">.</span><span class="n">buttonWithType</span><span class="p">(</span><span class="no">UIButtonTypeRoundedRect</span><span class="p">)</span>
  <span class="n">sign_in_button</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="o">[[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">280</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">295</span><span class="p">,</span> <span class="mi">40</span><span class="o">]]</span>
  <span class="n">sign_in_button</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;I have an account, sign-in to book&quot;</span><span class="p">,</span> <span class="n">forState</span><span class="ss">:UIControlStateNormal</span><span class="p">)</span>
  <span class="n">sign_in_button</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;is Highlighted&quot;</span><span class="p">,</span> <span class="n">forState</span><span class="ss">:UIControlStateHighlighted</span><span class="p">)</span>
  <span class="n">sign_in_button</span><span class="o">.</span><span class="n">titleLabel</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;HelveticaNeue-Light&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span><span class="mi">18</span><span class="p">)</span>
  <span class="n">sign_in_button</span><span class="o">.</span><span class="n">addTarget</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">action</span><span class="ss">:&#39;sign_in:&#39;</span><span class="p">,</span> <span class="n">forControlEvents</span><span class="ss">:UIControlEventTouchUpInside</span><span class="p">)</span>

  <span class="n">sign_in_button</span>
<span class="k">end</span>


<span class="k">def</span> <span class="nf">buttonForSignUp</span>

  <span class="n">sign_up_button</span> <span class="o">=</span> <span class="no">UIButton</span><span class="o">.</span><span class="n">buttonWithType</span><span class="p">(</span><span class="no">UIButtonTypeRoundedRect</span><span class="p">)</span>
  <span class="n">sign_up_button</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="o">[[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">350</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">295</span><span class="p">,</span> <span class="mi">40</span><span class="o">]]</span>
  <span class="n">sign_up_button</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Don&#39;t have an account, sign-up&quot;</span><span class="p">,</span> <span class="n">forState</span><span class="ss">:UIControlStateNormal</span><span class="p">)</span>
  <span class="n">sign_up_button</span><span class="o">.</span><span class="n">titleLabel</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;HelveticaNeue-Light&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span><span class="mi">18</span><span class="p">)</span>
  <span class="n">sign_up_button</span><span class="o">.</span><span class="n">addTarget</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">action</span><span class="ss">:&#39;sign_up&#39;</span><span class="p">,</span> <span class="n">forControlEvents</span><span class="ss">:UIControlEventTouchUpInside</span><span class="p">)</span>
  <span class="n">sign_up_button</span>
<span class="k">end</span>


<span class="k">def</span> <span class="nf">sign_in</span><span class="p">(</span> <span class="n">button</span> <span class="p">)</span>

  <span class="nb">p</span> <span class="s2">&quot;sign in button pressed </span><span class="si">#{</span><span class="n">button</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>


<span class="k">def</span> <span class="nf">sign_up</span>

  <span class="nb">p</span> <span class="s2">&quot;sign-up button pressed&quot;</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>And don&#8217;t forget to add the buttons to the view in the "viewDidLoad" method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">viewDidLoad</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">imageViewWithHeader</span> <span class="p">)</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">imageViewWithBackground</span> <span class="p">)</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">imageViewWithTitleBackground</span> <span class="p">)</span>

  <span class="vi">@next_event_name_label</span> <span class="o">=</span> <span class="n">labelWithNextEventName</span>
  <span class="vi">@days_left_label</span> <span class="o">=</span> <span class="n">labelWithDaysLeft</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="vi">@next_event_name_label</span> <span class="p">)</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="vi">@days_left_label</span> <span class="p">)</span>

  <span class="vi">@days_left_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="no">DAYS_LEFT_TEXT</span>
  <span class="vi">@next_event_name_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="no">EVENT_NAME_TEXT</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">buttonForSignIn</span> <span class="p">)</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">buttonForSignUp</span> <span class="p">)</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Let&#8217;s review what&#8217;s going on in those methods. First, we are creating a <strong>UIButton</strong> with the line.</p></div>
<div class="paragraph"><p><strong>UIButton.buttonWithType(UIButtonTypeRoundedRect)</strong></p></div>
<div class="paragraph"><p>As you may expect, there are other types of UIButtons that you can specify, such as:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>UIButtonTypeRoundedRect</strong>. Standard white button with rounded corners.
</p>
</li>
<li>
<p>
<strong>UIButtonTypeCustom</strong>. Defines a button with no style, very useful when you have your own set of images to use as a button.
</p>
</li>
<li>
<p>
<strong>UIButtonTypeDetailDisclosure</strong>. The standard button that appear in tables: a small blue circle with an arrow on it.
</p>
</li>
<li>
<p>
<strong>UIButtonTypeInfoLight</strong>. A small gray circle with an "i" on it.
</p>
</li>
<li>
<p>
<strong>UIButtonTypeInfoDark</strong>. A small dark gray circle with an "i" on it.
</p>
</li>
<li>
<p>
<strong>UIButtonTypeContactAdd</strong>. A small blue circle with the plus sign on it.
</p>
</li>
</ul></div>
<div class="paragraph"><p>You can try these types in the app.</p></div>
<div class="paragraph"><p>The second thing you have to notice is how to add text to the button (this only works if the type is Round Rect or Custom):</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">sign_in_button</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;I have an account, sign-in to book&quot;</span><span class="p">,</span> <span class="n">forState</span><span class="ss">:UIControlStateNormal</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>We do that with the method <strong>setTitle:forState</strong>. The first argument is a <strong>NSString</strong> with the text, the second one specifies in which state should the text appear. A <strong>UIButton</strong> has the following states:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>UIControlStateNormal</strong>. The default state of the button.
</p>
</li>
<li>
<p>
<strong>UIControlStateHighlighted</strong>. When the button is pressed.
</p>
</li>
<li>
<p>
<strong>UIControlStateDisabled</strong>. When the button is disabled (its enabled property is set to false).
</p>
</li>
</ul></div>
<div class="paragraph"><p>As you can see, for the Sign-In button we are specifying a title for the highlight state, when you run the app and press that button you will se that the title changes to the one for the highlighted state.</p></div>
<div class="paragraph"><p>We are also changing the default font of the button:</p></div>
<div class="paragraph"><p><strong>sign_in_button.titleLabel.font = UIFont.fontWithName("HelveticaNeue-Light", size:18)</strong></p></div>
<div class="paragraph"><p>Finally we are connecting the UIButton to our View Controller:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">sign_in_button</span><span class="o">.</span><span class="n">addTarget</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span>
                         <span class="n">action</span><span class="ss">:&#39;sign_in:&#39;</span><span class="p">,</span>
                         <span class="n">forControlEvents</span><span class="ss">:UIControlEventTouchUpInside</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The method <strong>addTarget:action:forControlEvents</strong> is the standard way to communicate a <strong>UIControl</strong> with a <strong>UIViewController</strong>. This method specifies which object and which method inside that object should be notified when an specific Event happens in such <strong>UIControl</strong>.</p></div>
<div class="paragraph"><p>In this case we are saying that <strong>self</strong> (the current <strong>UIViewController</strong> instance) should be notified through the <strong>sign_in:</strong> method when the <strong>UIButton</strong> is pressed and released (<strong>UIControlEventTouchUpInside</strong>). The action is actually a <strong>selector</strong> in CocoaTouch: a <strong>NSString</strong> with the name of the method. This name will be resolved into a concrete method in Runtime. In this example, this method will be called:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">sign_in</span><span class="p">(</span> <span class="n">button</span> <span class="p">)</span>

  <span class="nb">p</span> <span class="s2">&quot;sign in button pressed </span><span class="si">#{</span><span class="n">button</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>As you can see, the name of the method has a ":", because it has one argument. Using this target-selector approach to communicate, the UIControl that triggers the communication can be passed as an argument. In this example, it is the UIButton.</p></div>
<div class="paragraph"><p>In the other button, the sign-up one, we are not passing any argument:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">sign_up_button</span><span class="o">.</span><span class="n">addTarget</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span>
                         <span class="n">action</span><span class="ss">:&#39;sign_up&#39;</span><span class="p">,</span>
                         <span class="n">forControlEvents</span><span class="ss">:UIControlEventTouchUpInside</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Then, the selector method must be declared with no arguments:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">sign_up</span>

  <span class="nb">p</span> <span class="s2">&quot;sign-up button pressed&quot;</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Run the app and try the buttons. If both of them are appearing and invoke the specified methods, you have finished this workshop.</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch05-CocoaOverview/ch05_07_uibuttons.png" alt="UIButtons" />
</span></p></div>
</div>
<div class="sect2">
<h3 id="_challenge">Challenge</h3>
<div class="paragraph"><p>We included two standard buttons in our app, but our designer have made a really cool button. You can see it in the resources dir, is the image named <strong>btnBrown.png</strong>.</p></div>
<div class="paragraph"><p>Change the sign-up button to show this image. Tips: you will need to change the type of the button to a Custom one and need to use the <strong>setBackgroundImage:forState</strong> method.</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch05-CocoaOverview/ch05_08_challenge.png" alt="Challenge" />
</span></p></div>
</div>
</div>
</div>
<h1 id="_day_2">Day 2</h1>
<h1 id="_chapter_07_mapkit">Chapter 07 - MapKit</h1>
<div class="paragraph"><p>In this chapter we are going to review some concepts about delegation in CocoaTouch and how to use maps.</p></div>
<div class="sect1">
<h2 id="_preparing_the_app">Preparing the app</h2>
<div class="sectionbody">
<div class="paragraph"><p>Open the file <strong>ch07_mapkit_resources.zip</strong> and unzip it. Inside there is our Cocoaheads app. Run it with the <strong>rake</strong> command. You will see the main screen with the details of an event:</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch07-MapKit/ch07_01_app.png" alt="Chapter 7 app" />
</span></p></div>
<div class="paragraph"><p>When you tap on the <strong>View Map</strong> button a view that will contain the map appears:</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch07-MapKit/ch07_02_map.png" alt="Chapter 7 empty map view" />
</span></p></div>
<div class="paragraph"><p>Now open the Rakefile and examine the configuration. In this lab we are going to use the Location functionalities of CocoaTouch and the Maps. In order to do this we have to import some frameworks:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">app</span><span class="o">.</span><span class="n">frameworks</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;CoreLocation&#39;</span><span class="p">,</span> <span class="s1">&#39;MapKit&#39;</span><span class="o">]</span>
</pre></div></div></div>
<div class="paragraph"><p>CoreLocation is the framework that allows you to access the geo location and heading of the device. MapKit, in the other hand, provides an interface to embed maps into your applications as well as other advance functionality such as adding custom annotations, reverse-geocoding lookups, etc.</p></div>
<div class="sect2">
<h3 id="_adding_a_location_manager">Adding A Location Manager</h3>
<div class="paragraph"><p>The first thing we are going to add to our View Controller is a <strong>CLLocationManager</strong> to determine the device location and show how the delegation pattern works in CocoaTouch.</p></div>
<div class="paragraph"><p>In order to do this, open the <strong>event_detail_view_controller.rb</strong> file and locate the method named <strong>requestUserCurrenLocation</strong> Add the following lines:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="no">CLLocationManager</span><span class="o">.</span><span class="n">locationServicesEnabled</span><span class="p">)</span>

 <span class="vi">@location_manager</span> <span class="o">=</span> <span class="no">CLLocationManager</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>

  <span class="c1">#Play with other possible values: KCLLocationAccuracyBest, KCLLocationAccuracyHundredMeters, etc.</span>
  <span class="vi">@location_manager</span><span class="o">.</span><span class="n">desiredAccuracy</span> <span class="o">=</span> <span class="no">KCLLocationAccuracyKilometer</span>

  <span class="c1">#Set the current view controller as the delegate of the Location Manager, the location manager will notify of any changes in the location.</span>
  <span class="vi">@location_manager</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span>

  <span class="vi">@location_manager</span><span class="o">.</span><span class="n">purpose</span> <span class="o">=</span> <span class="s2">&quot;To provide functionality based on user&#39;s current location&quot;</span>
  <span class="vi">@location_manager</span><span class="o">.</span><span class="n">startUpdatingLocation</span>

<span class="k">else</span>

  <span class="n">showAlertWithTitle</span><span class="p">(</span><span class="s1">&#39;Location Error&#39;</span><span class="p">,</span> <span class="s1">&#39;Please enable the Location Services for this app in Settings.&#39;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>First, we are checking if the user allow the device to use the location services. If not, we are showing an UIAlertView. Review the showAlertWithTitle method to learn how to present alerts in CocoaTouch.</p></div>
<div class="paragraph"><p>Then, we create our CLLocationManager. The first thing we set, is the <strong>desiredAccuracy</strong>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="vi">@location_manager</span><span class="o">.</span><span class="n">desiredAccuracy</span> <span class="o">=</span> <span class="no">KCLLocationAccuracyKilometer</span>
</pre></div></div></div>
<div class="paragraph"><p><strong>CLLocationManager</strong> supports a wide range of accuracies. This property specifies which method will be used to determine the current device location. By instance, an accuracy set to <strong>KCLLocationAccuracyBest</strong> will prompt iOS to use the GPS to determine the location and thus will spent more battery. Wheter an accuracy set to KCLLocationAccuracyKilometer will be more conservative in the use of the device&#8217;s resourcers.</p></div>
<div class="paragraph"><p>Remember that an iOS device can use up to 3 ways to determine its location:</p></div>
<div class="ulist"><ul>
<li>
<p>
GPS. For devices with that functionality such and iPhones or iPads with GSM/LTE.
</p>
</li>
<li>
<p>
Cell towers triangulation. For devices with GSM/LTE.
</p>
</li>
<li>
<p>
WiFi hotspots.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The accuracy goes from best to worse in that order. You should choose carefully the desired accuracy according to your app functionality. An <strong>KCLLocationAccuracyBest</strong> accuracy is best suited to navigation apps or running apps where you need the best possible value for the current location. In the other hand, an app such as the Cocoaheads apps can work with an accuracy of <strong>KCLLocationAccuracyKilometer</strong>. We only need to know if the user is close to the meeting venue.</p></div>
<div class="paragraph"><p>Next, we set the View Controller as a delegate to the location manager:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="vi">@location_manager</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span>
</pre></div></div></div>
<div class="paragraph"><p>Thus, the <strong>CLLocationManager</strong> instance will notifiy us when a change in the device&#8217;s location occurs.</p></div>
<div class="paragraph"><p>With the line</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="vi">@location_manager</span><span class="o">.</span><span class="n">purpose</span> <span class="o">=</span> <span class="s2">&quot;To provide functionality based on user&#39;s current location&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>We define the message that the device will show to the user when it ask permission to access the location data.</p></div>
<div class="paragraph"><p>And, finally with <strong>@location_manager.startUpdatingLocation</strong> we start the tracking for the device&#8217;s location.</p></div>
<div class="paragraph"><p>But, how are we going to be notified when the CLLocationManager determines the device&#8217;s current location? We need to implement some methods from the <strong>CLLocationManagerDelegate</strong> protocol. Write this methods in the View Controller:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">#CLLocationManagerDelegate methods</span>

<span class="k">def</span> <span class="nf">locationManager</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">didUpdateToLocation</span><span class="ss">:newLocation</span><span class="p">,</span> <span class="n">fromLocation</span><span class="ss">:oldLocation</span><span class="p">)</span>

  <span class="vi">@location_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Latitude:</span><span class="si">#{</span><span class="n">newLocation</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">latitude</span><span class="si">}</span><span class="s2"> Longitude:</span><span class="si">#{</span><span class="n">newLocation</span><span class="o">.</span><span class="n">coordinate</span><span class="o">.</span><span class="n">longitude</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">locationManager</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">didFailWithError</span><span class="ss">:error</span><span class="p">)</span>

  <span class="n">showAlertWithTitle</span><span class="p">(</span> <span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="n">andMessage</span><span class="ss">:error</span><span class="o">.</span><span class="n">description</span> <span class="p">)</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>CLLocationManager will invoke the method <strong>locationManager:didUpdateToLocation:fromLocation</strong> of its delegate when it can determine a change in the device&#8217;s location. In this case we are updating in a UILabel the coordinates of the device. The object for both newLocation and oldLocation arguments is <strong>CLLocation</strong>. This class gives you access to values such as latitude, longitude and some other variables like altitude and speed.</p></div>
<div class="paragraph"><p>If an error occurs, the second method <strong>locationManager:didFailWithError</strong> will be called.</p></div>
<div class="paragraph"><p>Run the example, and try changing the simulator location in the Debug menu using the Location option. There are some predifined locations and you can specify a custom one by entering its latitude and longitude:</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch07-MapKit/ch07_03_location.png" alt="Chapter 7 location" />
</span></p></div>
</div>
<div class="sect2">
<h3 id="_creating_a_small_map">Creating a small Map</h3>
<div class="paragraph"><p>The next step is to add a small map just below the label where our location is being drawn. In CocoaTouch we use the <strong>MKMapView</strong> class to render maps. Locate the method named <strong>mapViewForEvent</strong> in the <strong>event_detail_view_controller.rb</strong> file. Copy this code:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">mapViewForEvent</span>

  <span class="n">map_view_for_event</span> <span class="o">=</span> <span class="no">MKMapView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span> <span class="o">[[</span><span class="mi">25</span><span class="p">,</span><span class="mi">210</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">270</span><span class="p">,</span> <span class="mi">80</span><span class="o">]]</span> <span class="p">)</span>
  <span class="n">map_view_for_event</span><span class="o">.</span><span class="n">mapType</span> <span class="o">=</span> <span class="no">MKMapTypeStandard</span>
  <span class="n">map_view_for_event</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>As you can see, there is nothing special about creating a <strong>MKMapView</strong> You just used the old <strong>initWithFrame</strong>. The second line, though, is more interesting. In that we specify the type of map we want to render. <strong>MKMapView</strong> supports three types of maps:</p></div>
<div class="ulist"><ul>
<li>
<p>
MKMapTypeStandard. Displays a street map that shows the position of all roads and some road names.
</p>
</li>
<li>
<p>
MKMapTypeSatellite. Displays satellite imagery of the area.
</p>
</li>
<li>
<p>
MKMapTypeHybrid. Displays a satellite image of the area with road and road name information layered on top.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Finally, add the map view to the main view in the <strong>viewDidLoad</strong> method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">mapViewForEvent</span> <span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Run your app, you should see a small map view in the middle</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch07-MapKit/ch07_04_smallmap.png" alt="Chapter 7 small map" />
</span></p></div>
</div>
<div class="sect2">
<h3 id="_creating_a_map_with_annotations">Creating a map with annotations</h3>
<div class="paragraph"><p>When you tap on the <strong>View Map</strong> button, currently is showing an empty view. We are going to fix this. Open the <strong>event_map_view_controller.rb</strong> file and locate the method called <strong>mapViewWithEventLocation</strong> That method should return a mapview with its type set to MKMapTypeStandard, just as the <strong>mapViewForEvent</strong> we implemented in the previous controller.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">mapViewWithEventLocation</span>

  <span class="n">map_view_for_event</span> <span class="o">=</span> <span class="no">MKMapView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span> <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">bounds</span> <span class="p">)</span>
  <span class="n">map_view_for_event</span><span class="o">.</span><span class="n">mapType</span> <span class="o">=</span> <span class="no">MKMapTypeStandard</span>
  <span class="n">map_view_for_event</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Once you have done that, add the view to the main view in the <strong>viewDidLoad</strong> adding the following line before inserting any other view:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">viewDidLoad</span>

  <span class="k">super</span>
  <span class="vi">@map_view_for_event</span> <span class="o">=</span> <span class="n">mapViewWithEventLocation</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="vi">@map_view_for_event</span> <span class="p">)</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">segmentedControlWithMapOptions</span> <span class="p">)</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">buttonToCloseScreen</span> <span class="p">)</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Run your example, you should see something like this:</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch07-MapKit/ch07_05_bigmap.png" alt="Chapter 7 big map" />
</span></p></div>
<div class="paragraph"><p>The next step is to show a Pin in the location of the next meeting and to center the map near that spot. First, we are going to center the map around the event location. You can see that this View Controller has an instance variable named <strong>event</strong> of type <strong>Event</strong>. This class has a location attribute, with the latitude and longitude of the venue. We are going to use that property to extract the location around the map will be centered.</p></div>
<div class="paragraph"><p><strong>MapKit</strong> uses a special structure called <strong>MKCoordinateRegion</strong> that has a <strong>CLLocationCoordinate2D</strong> - a structure which latitude and longitude values - and a <strong>MKCoordinateSpan</strong>, that represents the amount of map to display in the vertical and horizontal space. You can see this Span as the zoom that the map will have.</p></div>
<div class="paragraph"><p>Let&#8217;s create a method that returns our <strong>MKCoordinateRegion</strong>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">regionForEventLocation</span>

  <span class="n">region</span> <span class="o">=</span> <span class="no">MKCoordinateRegionMake</span><span class="p">(</span><span class="vi">@event</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="no">MKCoordinateSpanMake</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="o">.</span><span class="mi">7</span><span class="p">))</span>
  <span class="n">region</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>We are using the function MKCoordinateRegionMake, that takes 2 arguments: the <strong>CLLocationCoordinate2D</strong> that we retrieve from the <strong>@event</strong> variable and a <strong>MKCoordinateSpan</strong> that we are creating using another function: <strong>MKCoordinateSpanMake</strong> with the vertical and horizontal values.</p></div>
<div class="paragraph"><p>Now, add this region to the <strong>@map_view_for_event</strong> in the <strong>viewDidLoad</strong> method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="vi">@map_view_for_event</span><span class="o">.</span><span class="n">setRegion</span><span class="p">(</span><span class="n">regionForEventLocation</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Run the app and you should see that the maps is centered and zoomed in around San José, California (the event has as its location the Apple HQ in Cupertino.):</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch07-MapKit/ch07_06_mapregion.png" alt="Chapter 7 map region" />
</span></p></div>
<div class="paragraph"><p>Finally, we are going to add a Pin -Annotations in MapKit terms. in the venue location. To add an Annotation in Objective-C you must create a class that explicitly implements the MKAnnotation protocol. In RubyMotion you only need to create a class with the same methods defined in the protocol. These methods are:</p></div>
<div class="ulist"><ul>
<li>
<p>
coordinate. Returns a CLLocationCoordinate
</p>
</li>
<li>
<p>
title. NSString with the main title of the Annotation.
</p>
</li>
<li>
<p>
subtitle. Optional, returns an NSString with the subtitle of the annotation.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Create a new file inside the <strong>models</strong> folder named <strong>event_annotation.rb</strong>. Copy this code inside:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">EventAnnotation</span>

  <span class="k">def</span> <span class="nf">initWithCoordinate</span><span class="p">(</span> <span class="n">coordinate</span><span class="p">,</span> <span class="n">title</span><span class="ss">:title</span><span class="p">,</span> <span class="n">andSubTitle</span><span class="ss">:subtitle</span><span class="p">)</span>

    <span class="vi">@coordinate</span> <span class="o">=</span> <span class="n">coordinate</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="n">title</span>
    <span class="vi">@subtitle</span> <span class="o">=</span> <span class="n">subtitle</span>

    <span class="nb">self</span>
  <span class="k">end</span>


  <span class="k">def</span> <span class="nf">coordinate</span>

    <span class="vi">@coordinate</span>
  <span class="k">end</span>


  <span class="k">def</span> <span class="nf">title</span>

    <span class="vi">@title</span>
  <span class="k">end</span>


  <span class="k">def</span> <span class="nf">subtitle</span>

    <span class="vi">@subtitle</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>We are only defining an initializer method that receives the coordinate, the title and the subtitle and the methods defined in the <strong>MKAnnotation</strong> protocol. Now we are ready to add our annotation to the Map.</p></div>
<div class="paragraph"><p>Add this method that creates an instance of our custom annotation:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">annotationForEvent</span>

  <span class="no">EventAnnotation</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithCoordinate</span><span class="p">(</span><span class="vi">@event</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">title</span><span class="ss">:event</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">andSubTitle</span><span class="ss">:event</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>In the <strong>viewDidLoad</strong> method, add the annotation to the map:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="vi">@map_view_for_event</span><span class="o">.</span><span class="n">addAnnotation</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Run the example and you should see a red pin in the event&#8217;s location, if you tap on it you will see the title and subtitle displayed inside a callout:</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch07-MapKit/ch07_07_annotation.png" alt="Chapter 7 map annotation" />
</span></p></div>
<div class="paragraph"><p>If you see the annotation displayed correctly, you have finished this lab.</p></div>
</div>
<div class="sect2">
<h3 id="_challenge_2">Challenge</h3>
<div class="paragraph"><p>As you can see in the app, we are displaying a toggle buttons to change the type of the map. If you are curious about how do you create such controls, review the <strong>segmentedControlWithMapOptions</strong> method. This control is called <strong>UISegmentedControl</strong> and you only need to specify the options that will have in order to create it. We are also defining a target-selector that will be notified when the user taps in a button. The selector is the method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">switch_map_type</span><span class="p">(</span><span class="n">segmented_control</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Your challenge is to implement the logic to change the map type. A tip that will help you: with <strong>segmented_control.selectedSegmentIndex</strong> you can access the current button selected index. Using this you&#8217;ll be able to determine which map type you should set to the <strong>@map_view_for_event.type</strong> variable.</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch07-MapKit/ch07_08_challenge.png" alt="Chapter 7 map challenge" />
</span></p></div>
</div>
</div>
</div>
<h1 id="_chapter_08_uiviews">Chapter 08 - UIViews</h1>
<div class="paragraph"><p>Our designer has came up with a better design for our first screen, the one we develop during Chapter 5. He thought that we could present the days left until the next meeting with a custom view representing a flip calendar rather than using a simple text label:</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch08-UIViews/ch08_01_app.png" alt="Chapter 8 final app" />
</span></p></div>
<div class="paragraph"><p>So we have deleted the old label with the days left, open the file <strong>ch08-uiviews.zip</strong> and unzip the RubyMotion project. Run it, you should see our old view without the days left information:</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch08-UIViews/ch08_02_starting_app.png" alt="Chapter 8 starting app" />
</span></p></div>
<div class="sect2">
<h3 id="_creating_a_custom_uiview">Creating a custom UIView</h3>
<div class="paragraph"><p>When you face the challenge of creating a custom component such as this flip calendar, is often required to create a custom UIView. Custom UIViews gives you complete control over the look and logic of a UIView.</p></div>
<div class="paragraph"><p>To implement them, you must begin creating a class that inherits from UIView. Create a new file named <strong>flipcount_view.rb</strong> . Inside this file, declare a new class:+</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FlipCountView</span> <span class="o">&lt;</span> <span class="no">UIView</span>

  <span class="kp">attr_accessor</span> <span class="ss">:days_left</span>

  <span class="k">def</span> <span class="nf">initWithFrame</span><span class="p">(</span> <span class="n">frame</span> <span class="p">)</span>

    <span class="k">super</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">whiteColor</span>
    <span class="nb">self</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Until now, we have only declared the class and one public attribute called <strong>days_left</strong>. We are also overwriting the <strong>initWithFrame:</strong> initializer. Remember that this method is used to create UIViews. We are just setting the background color of the UIView to white. Let&#8217;s test it. In the <strong>next_event_view_controller.rb</strong> file create this method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">viewWithDaysLeft</span>
  <span class="n">days_left_view</span> <span class="o">=</span> <span class="no">FlipCountView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span> <span class="o">[[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">120</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="mi">68</span><span class="p">,</span> <span class="mi">74</span><span class="o">]]</span> <span class="p">)</span>
  <span class="n">days_left_view</span><span class="o">.</span><span class="n">days_left</span> <span class="o">=</span> <span class="vi">@days_left</span>
  <span class="n">days_left_view</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>We are creating a FlipCountView with a frame that places it to the left of the event&#8217;s name label. Now add it to your view in the <strong>viewDidLoad</strong> method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre> <span class="k">def</span> <span class="nf">viewDidLoad</span>

  <span class="k">super</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">imageViewWithHeader</span> <span class="p">)</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">imageViewWithBackground</span> <span class="p">)</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">imageViewWithTitleBackground</span> <span class="p">)</span>
  <span class="vi">@next_event_name_label</span> <span class="o">=</span> <span class="n">labelWithNextEventName</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="vi">@next_event_name_label</span> <span class="p">)</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">buttonForSignIn</span> <span class="p">)</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">buttonForSignUp</span> <span class="p">)</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="n">buttonToChangeDaysLeft</span> <span class="p">)</span>

  <span class="vi">@days_left_view</span> <span class="o">=</span> <span class="n">viewWithDaysLeft</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span> <span class="vi">@days_left_view</span> <span class="p">)</span>


  <span class="vi">@next_event_name_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="no">EVENT_NAME_TEXT</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Remember that always that you add a UIView to an instance variable, you must set it to <strong>nil</strong> in the <strong>viewDidUnload</strong> method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">viewDidUnload</span>

  <span class="k">super</span>
  <span class="vi">@next_event_name_label</span> <span class="o">=</span> <span class="kp">nil</span>
  <span class="vi">@days_left_view</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Now test the application. You will see a white rectangle:</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch08-UIViews/ch08_03_rectangle.png" alt="Chapter 8 rectangle" />
</span></p></div>
</div>
<div class="sect2">
<h3 id="_drawing_text">Drawing text</h3>
<div class="paragraph"><p>Now, we have to add the text for the <strong>@days_left</strong> attribute. We have seen that we can use a <strong>UILabel</strong> to render text on the screen. However, we are going to see a different low-level approach: to draw the text inside the view.</p></div>
<div class="paragraph"><p>Every <strong>UIView</strong> knows how to draw itself in the screen. If you want to implement your custom drawing logic, you should override the method <strong>drawRect:</strong> It is very important that you handle this method very carefully. This method is called directly by iOS every time that the screen needs to be rendered: the first time it is displayed or when part of the view is invalidated. So it is not recommended to do some heavy computations inside the method, that will reduce the performance of your app.</p></div>
<div class="paragraph"><p>Lets implement the <strong>drawRect:</strong> method that draws the days left:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">drawRect</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>

  <span class="n">drawDaysLeftInRect</span> <span class="n">rect</span>
<span class="k">end</span>


<span class="k">def</span> <span class="nf">drawDaysLeftInRect</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>

  <span class="n">big_font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;HelveticaNeue-Bold&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span><span class="mi">48</span><span class="p">)</span>
  <span class="vi">@days_left</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">drawAtPoint</span><span class="p">(</span><span class="o">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span> <span class="o">]</span><span class="p">,</span> <span class="n">withFont</span><span class="ss">:big_font</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Inside the <strong>drawDaysLeftInRect:</strong> method we are creating a UIFont and then we are rendering directly the days_left. This attribute is an <strong>Integer</strong>, thus we need to converting to <strong>String</strong> with <strong>to_s</strong>. In RubyMotion traditional <strong>String</strong> class of Ruby inherits from <strong>NSMutableString</strong> that is why we could use the method <strong>drawAtPoint</strong>. This method is actually rendering the String inside the view at the given point using the font passed as an argument.</p></div>
<div class="paragraph"><p>Run the example and you should see the "0" rendered inside the custom view:</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch08-UIViews/ch08_04_zero.png" alt="Chapter 8 drawn label" />
</span></p></div>
<div class="paragraph"><p>Now we are going to render the legend  "days left" at the bottom. In order to this we are going to calculate the Y coordinate using the <strong>rect</strong> of the view:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">drawDaysLeftLegendInRect</span><span class="p">(</span> <span class="n">rect</span> <span class="p">)</span>

  <span class="n">small_font</span> <span class="o">=</span> <span class="no">UIFont</span><span class="o">.</span><span class="n">fontWithName</span><span class="p">(</span><span class="s2">&quot;HelveticaNeue&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span>
  <span class="s2">&quot;days left&quot;</span><span class="o">.</span><span class="n">drawAtPoint</span><span class="p">(</span><span class="o">[</span><span class="mi">11</span><span class="p">,</span> <span class="n">rect</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">24</span> <span class="o">]</span><span class="p">,</span> <span class="n">withFont</span><span class="ss">:small_font</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Remember to call this method from the <strong>drawRect:</strong> one:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">drawRect</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>

  <span class="n">drawDaysLeftInRect</span> <span class="n">rect</span>
  <span class="n">drawDaysLeftLegendInRect</span> <span class="n">rect</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Run the example and you sould see the legend rendered at the bottom:</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch08-UIViews/ch08_05_legend.png" alt="Chapter 8 drawn legend" />
</span></p></div>
</div>
<div class="sect2">
<h3 id="_drawing_images">Drawing images</h3>
<div class="paragraph"><p>Our designer has created a background image to use in our view. The image is called <strong>flipDateImage.png</strong> We have seen that we could insert a UIImageView into our view to render images. But, this time we are going to use a low-level approach: we are going to render the image directly in our <strong>drawRect:</strong> method.</p></div>
<div class="paragraph"><p>Create this method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">drawBackgroundImageInRect</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>

  <span class="n">backgroundImage</span> <span class="o">=</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span> <span class="s2">&quot;flipDateImage&quot;</span> <span class="p">)</span>
  <span class="n">backgroundImage</span><span class="o">.</span><span class="n">drawInRect</span><span class="p">(</span> <span class="n">rect</span> <span class="p">)</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>As you can see, a UIImage also knows how to render itself using the <strong>drawInRect:</strong> method. In this case, we want the image to be drawn in the full view, that is why we are passing the whole <strong>rect</strong> as a parameter.</p></div>
<div class="paragraph"><p>Now, invoke this method from inside the <strong>drawRect:</strong> method. You should render the image before drawing the texts, otherwise the image will be drawn covering the texts:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">drawRect</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>

  <span class="n">drawBackgroundImageInRect</span> <span class="n">rect</span>
  <span class="n">drawDaysLeftLegendInRect</span> <span class="n">rect</span>
  <span class="n">drawDaysLeftInRect</span> <span class="n">rect</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Finally, let&#8217;s change the view color to <strong>clearColor</strong> so the image will be the only thing acting as a background.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">initWithFrame</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

  <span class="k">super</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">clearColor</span>
  <span class="nb">self</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Run your app and you should see the image rendered in the background of the app:</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch08-UIViews/ch08_06_image.png" alt="Chapter 8 drawn image" />
</span></p></div>
</div>
<div class="sect2">
<h3 id="_invalidating_a_view">Invalidating a view</h3>
<div class="paragraph"><p>As you can see, we have a <strong>UIButton</strong> with the title "Increase days left". We want to use it to test our custom view by changing the days left attribute. Locate the method named <strong>change_days_left</strong> and implement the logic to increase the <strong>@days_left</strong> property and update it in our custom view instance:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">change_days_left</span>

  <span class="vi">@days_left</span> <span class="o">=</span> <span class="vi">@days_left</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="vi">@days_left_view</span><span class="o">.</span><span class="n">days_left</span> <span class="o">=</span> <span class="vi">@days_left</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>As you can see, we are increasing the value of the variable by 1, and then we are updating that value in our custom view instance. It seem right, isn&#8217;t it? Run the example and tap the "Increase days left" button.</p></div>
<div class="paragraph"><p>Nothing happens. Why? because our custom <strong>UIView</strong> only renders the days left in its <strong>drawRect:</strong> method. This method is called by CocoaTouch when the view is first rendered (in this case is when we add it to our main view) and when the view is invalidated so it has to be rendered again. In this case, neither of those scenarios is presented. So the view is never updated with the new value. You may feel tempted to just call the <strong>drawRect:</strong> method directly, but that is something you should never do. CocoaTouch is responsible of calling that method in the appropiate moment. Instead of that, we need to invalidate the view and CocoaTouch will call the <strong>drawRect:</strong> method in the next drawing cycle. So just add this line at the end of the method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="vi">@days_left_view</span><span class="o">.</span><span class="n">setNeedsDisplay</span>
</pre></div></div></div>
<div class="paragraph"><p><strong>setNeedsDisplay</strong> is the method of <strong>UIView</strong> to mark that it needs to be redrawn. CocoaTouch will call the <strong>drawRect:</strong> and that method will draw the days left with the updated value:</p></div>
<div class="paragraph"><p><span class="image">
<img src="Resources/ch08-UIViews/ch08_07_needdisplay.png" alt="Chapter 8 need display" />
</span></p></div>
<div class="paragraph"><p>If you see the view being updated when you tap on the button, you have finish this lab.</p></div>
</div>
<h1 id="_day_3">Day 3</h1>
<h1 id="_day_4">Day 4</h1>
<h1 id="_chapter_20_calayers">Chapter 20 - CALayers</h1>
<div class="paragraph"><p>In this chapter we will use a Cocoa Touch Framework called Core Animation. This framework is has two main purposes: Composition and Animation, taking this as base we will look into the Composition part first.</p></div>
<div class="sect1">
<h2 id="_composition">Composition</h2>
<div class="sectionbody">
<div class="paragraph"><p>Speaking in terms of Visual Arts, the term <strong>Composition</strong> is the placement or arrangement of visual elements to integrate a work of art. The Visual Artists (Most of them Graphical Designers) execute this technique in Photographs, Paints, or Designs.</p></div>
<div class="paragraph"><p>Until this part of the course we just have seen an object used to draw something in the screen: The <strong>UIView</strong>. Speaking in terms of memory and performance the UIView is a heavyweight champion, what this means is that it takes a lot of resources to animate it or display multiple of them on the screen. (You can try it! Load more than 50 UIViews with different colors on any project).</p></div>
<div class="paragraph"><p>Because of this if we want to create a complex composition we need a more light object, and it is called "CALayer". If the UIViews are a 1 Dollar in terms of memory and performance, the CALayer is 15 Cents.</p></div>
<div class="paragraph"><p>So the next question will be, why we are still using UIViews? The correct answer is that the CALayers have less features like the support for gestures, easy custom drawing using Core Graphics (You can do it on the CALayer but is more complex to implement), auto resizing masks. Besides what you will see in terms of implementation in the following exercises.</p></div>
<div class="paragraph"><p>Said this its a great time to start coding:</p></div>
<div class="sect2">
<h3 id="_initial_project">Initial Project</h3>
<div class="paragraph"><p>As we have seen through the course, the way to create a new Project is the following:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>motion create Layers
</pre></div></div></div>
<div class="paragraph"><p>For us to use the Core Animation Framework first we need to add it to the app, open the <strong>Rake File</strong>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>Layers

<span class="nv">$ </span>open Rakefile
</pre></div></div></div>
<div class="paragraph"><p>To add a new framework to the app, you need to add the last line in the method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="no">Motion</span><span class="o">::</span><span class="no">Project</span><span class="o">::</span><span class="no">App</span><span class="o">.</span><span class="n">setup</span> <span class="k">do</span> <span class="o">|</span><span class="n">app</span><span class="o">|</span>

  <span class="c1"># Use `rake config&#39; to see complete project settings.</span>
  <span class="n">app</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Layers&#39;</span>

  <span class="n">app</span><span class="o">.</span><span class="n">frameworks</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;QuartzCore&quot;</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Next we need to add a View Controller where we will implement a CALayer, lets call it <strong>Layer View Controller</strong>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>app

<span class="nv">$ </span>mkdir controllers

<span class="nv">$ </span><span class="nb">cd </span>controllers

<span class="nv">$ </span>touch layer_view_controller.rb

<span class="nv">$ </span>open layer_view_controller.rb
</pre></div></div></div>
<div class="paragraph"><p>Add the following code to our new file:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">LayerViewController</span> <span class="o">&lt;</span> <span class="no">UIViewController</span>

  <span class="k">def</span> <span class="nf">loadView</span>

    <span class="c1"># Lets create a view for our view controller</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="no">UIView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">255</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">686</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">988</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># When we create a new instance of a CALayer, the designated initializer</span>
    <span class="c1"># is the following one</span>
    <span class="n">red_layer</span> <span class="o">=</span> <span class="no">CALayer</span><span class="o">.</span><span class="n">layer</span>
    <span class="n">red_layer</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">redColor</span><span class="o">.</span><span class="n">CGColor</span>

    <span class="c1"># A difference from a UIView is that the CALayer uses the frame only</span>
    <span class="c1"># to determine its size, the position is set in the position property</span>
    <span class="c1"># this is required because the Layers has it position in the center of it</span>
    <span class="c1"># instead of top left corner, like the UIView.</span>
    <span class="n">red_layer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="no">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">red_layer</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="no">CGPointMake</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

    <span class="c1"># The view has a property called layer, every UIView has a layer inside</span>
    <span class="c1"># it. So we can add our layer as a sublayer of that one.</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="n">addSublayer</span><span class="p">(</span><span class="n">red_layer</span><span class="p">)</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">Please take a moment to understand the changes related to the coordinate system on the CALayer (Hint: Frame &amp; Position)</td>
</tr></table>
</div>
<div class="paragraph"><p>Lets continue opening the Application Delegate and adding the following:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> ..

<span class="nv">$ </span><span class="nb">cd</span> ..

<span class="nv">$ </span>open app_delegate.rb
</pre></div></div></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">application</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="n">didFinishLaunchingWithOptions</span><span class="ss">:launchOptions</span><span class="p">)</span>

  <span class="c1">#Create an instance of Layer View Controller</span>
  <span class="n">layer_view_controller</span> <span class="o">=</span> <span class="no">LayerViewController</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>

  <span class="vi">@window</span> <span class="o">=</span> <span class="no">UIWindow</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">UIScreen</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

  <span class="c1">#Every window has a root view controller from which it will present its view</span>
  <span class="vi">@window</span><span class="o">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="n">layer_view_controller</span>
  <span class="vi">@window</span><span class="o">.</span><span class="n">makeKeyAndVisible</span>
  <span class="kp">true</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>If we run the App you must see the following:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>rake
</pre></div></div></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch20-CALayers/ch20_REPL1.png" alt="Initial Run" />
</div>
<div class="title">Figure 14. Initial Run</div>
</div>
</div>
<div class="sect2">
<h3 id="_changing_layers">Changing Layers</h3>
<div class="paragraph"><p>Lets use a little of REPL to illustrate some points, please look at your terminal at the same time with the simulator, and execute the following:</p></div>
<div class="paragraph"><p>First select the blue view using CMD + click on it, later run this on your console:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="c">#&lt;UIView:0x000000)&gt; layer = self.layer.sublayers.objectAtIndex(0)</span>
<span class="o">=</span>&gt; <span class="c">#&lt;CALayer:0x000000&gt;</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">Take note that you can not select Layers using the CMD + click</td>
</tr></table>
</div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="c">#&lt;UIView:0x000000)&gt; layer.backgroundColor = UIColor.colorWithRed(0.957, green:0.824, blue:0.184, alpha:1.0).CGColor</span>
</pre></div></div></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch20-CALayers/ch20_REPL2.png" alt="Yellow Square" />
</div>
<div class="title">Figure 15. Yellow Square</div>
</div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="c">#&lt;UIView:0x000000)&gt; layer.position = CGPointMake(100, 100)</span>
</pre></div></div></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch20-CALayers/ch20_REPL3.png" alt="Yellow Square in a Different Position" />
</div>
<div class="title">Figure 16. Yellow Square in a Different Position</div>
</div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="c">#&lt;UIView:0x000000)&gt; layer.cornerRadius = 20</span>
</pre></div></div></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch20-CALayers/ch20_REPL4.png" alt="Yellow Square with Rounded Corners" />
</div>
<div class="title">Figure 17. Yellow Square with Rounded Corners</div>
</div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="c">#&lt;UIView:0x000000)&gt; layer.borderWidth = 10</span>
<span class="o">(</span><span class="c">#&lt;UIView:0x000000)&gt; layer.borderColor = UIColor.colorWithRed(0.988, green:0.604, blue:0.153, alpha:1.0).CGColor</span>
</pre></div></div></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch20-CALayers/ch20_REPL5.png" alt="Yellow Square with Border" />
</div>
<div class="title">Figure 18. Yellow Square with Border</div>
</div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="c">#&lt;UIView:0x000000)&gt; layer.shadowRadius = 5.0</span>
<span class="o">(</span><span class="c">#&lt;UIView:0x000000)&gt; layer.shadowColor = UIColor.blackColor.CGColor</span>
<span class="o">(</span><span class="c">#&lt;UIView:0x000000)&gt; layer.shadowOpacity = 0.65</span>
</pre></div></div></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch20-CALayers/ch20_REPL6.png" alt="Yellow Square with Shadow" />
</div>
<div class="title">Figure 19. Yellow Square with Shadow</div>
</div>
<div class="paragraph"><p>They are two things important in this part, the first is that you can manipulate the appearance in more ways using a CALayer than a UIView like the Rounded Corners, Shadows, etc. Also if you look closely you must see that when you change some properties of the layer it animates it self, we will look into more deeply later on.</p></div>
</div>
<div class="sect2">
<h3 id="_putting_the_things_together">Putting the things together</h3>
<div class="paragraph"><p>Now that we have see the CALayers in action, is time to do somethings more complicated. Open your LayerViewController and add the following:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">$ </span>open layer_view_controller.rb
</pre></div></div></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">loadView</span>

  <span class="c1"># Lets create a view for our view controller</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="no">UIView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">UIScreen</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

  <span class="n">layout_background_layer</span><span class="p">()</span>
<span class="k">end</span>


<span class="k">def</span> <span class="nf">layout_background_layer</span>

  <span class="c1"># We need a new type of layer used to create Gradients</span>
  <span class="n">background_layer</span> <span class="o">=</span> <span class="no">CAGradientLayer</span><span class="o">.</span><span class="n">layer</span>
  <span class="n">background_layer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">bounds</span>

  <span class="c1"># Initialize the colors of the gradient, it can have any number of colors</span>
  <span class="c1"># in this case we will use only three</span>
  <span class="n">top_background_color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">131</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">387</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">618</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">CGColor</span>
  <span class="n">middle_background_color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">255</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">686</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">984</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">CGColor</span>
  <span class="n">bottom_background_color</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">367</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">692</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">CGColor</span>

  <span class="c1"># Set the colors in the layer using an array</span>
  <span class="n">background_layer</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="no">NSArray</span><span class="o">.</span><span class="n">arrayWithObjects</span><span class="p">(</span><span class="n">top_background_color</span><span class="p">,</span>
                                                    <span class="n">middle_background_color</span><span class="p">,</span>
                                                    <span class="n">bottom_background_color</span><span class="p">,</span>
                                                    <span class="kp">nil</span><span class="p">)</span>

  <span class="c1"># Set the colors locations into the array, this means where it will start painting</span>
  <span class="c1"># the color, if you look closely we are telling the layer to paint the top color in</span>
  <span class="c1"># 0.0 which is the top, the middle in 0.5 and 0.0 for the bottom color</span>
  <span class="n">background_layer</span><span class="o">.</span><span class="n">locations</span> <span class="o">=</span> <span class="no">NSArray</span><span class="o">.</span><span class="n">arrayWithObjects</span><span class="p">(</span><span class="no">NSNumber</span><span class="o">.</span><span class="n">numberWithFloat</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="p">),</span>
                                                       <span class="no">NSNumber</span><span class="o">.</span><span class="n">numberWithFloat</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="p">),</span>
                                                       <span class="no">NSNumber</span><span class="o">.</span><span class="n">numberWithFloat</span><span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="p">),</span>
                                                       <span class="kp">nil</span><span class="p">)</span>

  <span class="c1"># We want this layer to be the background of our app</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="n">insertSublayer</span><span class="p">(</span><span class="n">background_layer</span><span class="p">,</span> <span class="n">atIndex</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch20-CALayers/ch20_GradientBackground.png" alt="Background with Gradient" />
</div>
<div class="title">Figure 20. Background with Gradient</div>
</div>
<div class="paragraph"><p>Easy right? We create a nice background for our app using a gradient. Lets continue adding some grass into the composition:</p></div>
<div class="paragraph"><p>Please copy the <strong>Determine deployment target</strong> into our app resources folder, after that add the following method to our <strong>LayerViewController</strong> class</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">loadView</span>

  <span class="c1"># Lets create a view for our view controller</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="no">UIView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">UIScreen</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

  <span class="n">layout_background_layer</span>
  <span class="n">layout_grass_layer</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">layout_grass_layer</span>

  <span class="c1">#Lets instance a new layer for containing our grass image</span>
  <span class="n">grass_layer</span> <span class="o">=</span> <span class="no">CALayer</span><span class="o">.</span><span class="n">layer</span>
  <span class="n">grass_layer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">bounds</span>

  <span class="c1">#Load the image into memory</span>
  <span class="n">grassImage</span> <span class="o">=</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span><span class="s2">&quot;bgGrass.png&quot;</span><span class="p">)</span>

  <span class="c1"># Set the image as content of the layer</span>
  <span class="n">grass_layer</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="n">grassImage</span><span class="o">.</span><span class="n">CGImage</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="n">addSublayer</span><span class="p">(</span><span class="n">grass_layer</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch20-CALayers/ch20_GrassLayer.png" alt="Grass Layer" />
</div>
<div class="title">Figure 21. Grass Layer</div>
</div>
<div class="paragraph"><p>Great! Now you see that we are compositing two layers together and learn that you can also include an Image as a content. But how about drawing custom figures? Add the following to the <strong>LayerViewController</strong> class:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">loadView</span>

  <span class="c1"># Lets create a view for our view controller</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="no">UIView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">UIScreen</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

  <span class="n">layout_background_layer</span>
  <span class="n">layout_sun_layer</span>
  <span class="n">layout_grass_layer</span>
<span class="k">end</span>


<span class="k">def</span> <span class="nf">layout_sun_layer</span>

  <span class="c1"># Create a new type of layer, in this case CAShapeLayer</span>
  <span class="vi">@sun_layer</span> <span class="o">=</span> <span class="no">CAShapeLayer</span><span class="o">.</span><span class="n">layer</span>
  <span class="vi">@sun_layer</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="no">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
  <span class="vi">@sun_layer</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="no">CGPointMake</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

  <span class="c1"># Set some color for the figure fill and the stroke</span>
  <span class="vi">@sun_layer</span><span class="o">.</span><span class="n">fillColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">957</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">824</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">184</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">CGColor</span>
  <span class="vi">@sun_layer</span><span class="o">.</span><span class="n">strokeColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithRed</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">988</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">604</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">153</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">CGColor</span>

  <span class="c1"># We need to set a line width of 10 for this particular figure</span>
  <span class="vi">@sun_layer</span><span class="o">.</span><span class="n">lineWidth</span> <span class="o">=</span> <span class="mi">10</span>


  <span class="c1"># The following part is the path that composes the figure</span>
  <span class="c1"># point by point into the layer</span>
  <span class="n">sun_path</span> <span class="o">=</span> <span class="no">UIBezierPath</span><span class="o">.</span><span class="n">bezierPath</span>

  <span class="n">sun_path</span><span class="o">.</span><span class="n">moveToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">91</span><span class="o">.</span><span class="mi">15</span><span class="p">,</span> <span class="mi">48</span><span class="o">.</span><span class="mi">53</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">91</span><span class="o">.</span><span class="mi">15</span><span class="p">,</span> <span class="mi">48</span><span class="o">.</span><span class="mi">53</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">106</span><span class="o">.</span><span class="mo">00</span><span class="p">,</span> <span class="mi">41</span><span class="o">.</span><span class="mi">88</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">114</span><span class="o">.</span><span class="mi">90</span><span class="p">,</span> <span class="mi">55</span><span class="o">.</span><span class="mi">50</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">130</span><span class="o">.</span><span class="mi">99</span><span class="p">,</span> <span class="mi">57</span><span class="o">.</span><span class="mi">94</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">131</span><span class="o">.</span><span class="mi">11</span><span class="p">,</span> <span class="mi">74</span><span class="o">.</span><span class="mi">21</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">143</span><span class="o">.</span><span class="mi">33</span><span class="p">,</span> <span class="mi">84</span><span class="o">.</span><span class="mi">95</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">134</span><span class="o">.</span><span class="mi">63</span><span class="p">,</span> <span class="mi">98</span><span class="o">.</span><span class="mi">71</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">139</span><span class="o">.</span><span class="mi">10</span><span class="p">,</span> <span class="mi">114</span><span class="o">.</span><span class="mi">35</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">124</span><span class="o">.</span><span class="mi">35</span><span class="p">,</span> <span class="mi">121</span><span class="o">.</span><span class="mi">22</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">119</span><span class="o">.</span><span class="mi">65</span><span class="p">,</span> <span class="mi">136</span><span class="o">.</span><span class="mi">80</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">103</span><span class="o">.</span><span class="mi">53</span><span class="p">,</span> <span class="mi">134</span><span class="o">.</span><span class="mi">60</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">91</span><span class="o">.</span><span class="mi">15</span><span class="p">,</span> <span class="mi">145</span><span class="o">.</span><span class="mi">17</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">78</span><span class="o">.</span><span class="mi">78</span><span class="p">,</span> <span class="mi">134</span><span class="o">.</span><span class="mi">60</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">62</span><span class="o">.</span><span class="mi">66</span><span class="p">,</span> <span class="mi">136</span><span class="o">.</span><span class="mi">80</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">57</span><span class="o">.</span><span class="mi">96</span><span class="p">,</span> <span class="mi">121</span><span class="o">.</span><span class="mi">22</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">43</span><span class="o">.</span><span class="mi">21</span><span class="p">,</span> <span class="mi">114</span><span class="o">.</span><span class="mi">35</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">47</span><span class="o">.</span><span class="mi">68</span><span class="p">,</span> <span class="mi">98</span><span class="o">.</span><span class="mi">71</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">38</span><span class="o">.</span><span class="mi">98</span><span class="p">,</span> <span class="mi">84</span><span class="o">.</span><span class="mi">95</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">51</span><span class="o">.</span><span class="mi">20</span><span class="p">,</span> <span class="mi">74</span><span class="o">.</span><span class="mi">21</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">51</span><span class="o">.</span><span class="mi">32</span><span class="p">,</span> <span class="mi">57</span><span class="o">.</span><span class="mi">94</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">67</span><span class="o">.</span><span class="mi">41</span><span class="p">,</span> <span class="mi">55</span><span class="o">.</span><span class="mi">50</span><span class="p">))</span>
  <span class="n">sun_path</span><span class="o">.</span><span class="n">addLineToPoint</span><span class="p">(</span><span class="no">CGPointMake</span><span class="p">(</span><span class="mi">76</span><span class="o">.</span><span class="mi">31</span><span class="p">,</span> <span class="mi">41</span><span class="o">.</span><span class="mi">88</span><span class="p">))</span>

  <span class="n">sun_path</span><span class="o">.</span><span class="n">closePath</span>

  <span class="c1"># Set the path into the layer</span>
  <span class="vi">@sun_layer</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">sun_path</span><span class="o">.</span><span class="n">CGPath</span><span class="p">;</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="n">addSublayer</span><span class="p">(</span><span class="vi">@sun_layer</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch20-CALayers/ch20_SunLayer.png" alt="Sun Layer" />
</div>
<div class="title">Figure 22. Sun Layer</div>
</div>
</div>
<div class="sect2">
<h3 id="_implicit_animations">Implicit Animations</h3>
<div class="paragraph"><p>When you change some properties of a CALayer at run time, what happens is that the properties are modified in an animated way. This properties that trigger animations are called <strong>Animatable Properties</strong>, and some of them are the following:</p></div>
<div class="ulist"><ul>
<li>
<p>
anchorPoint
</p>
</li>
<li>
<p>
backgroundColor
</p>
</li>
<li>
<p>
borderColor
</p>
</li>
<li>
<p>
borderWidth
</p>
</li>
<li>
<p>
bounds
</p>
</li>
<li>
<p>
cornerRadius
</p>
</li>
<li>
<p>
mask
</p>
</li>
<li>
<p>
opacity
</p>
</li>
<li>
<p>
position
</p>
</li>
<li>
<p>
shadowColor
</p>
</li>
<li>
<p>
shadowOffset
</p>
</li>
<li>
<p>
shadowOpacity
</p>
</li>
<li>
<p>
shadowRadius
</p>
</li>
</ul></div>
<div class="paragraph"><p>For this to happen a process works inside of Core Animation called <strong>Interpolation</strong>, the best way to explain it is using a example:</p></div>
<div class="paragraph"><p>Lets say that you implemented a layer, but its needed when the user touches the screen to disappear the layer. Do this is pretty straight forward, just set the opacity property to 0.0. Inside Core Animation the next will happen:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Because we are using a implicit animation, the default time for the whole animation is 0.3
</p>
</li>
<li>
<p>
Core Animation calculates the value at every millisecond that takes to execute the animation. Starting at second 0 with 1.0, 0.1 with 0.65, 0.2 with 0.45, 0.3 with 0.0. This process of determining the values of a property (or properties) at every given time of the animation is called <strong>Interpolation</strong>
</p>
</li>
<li>
<p>
Then the resulting matrix property values and times is executed, giving the effect that the layer is being animated.
</p>
</li>
</ol></div>
<div class="paragraph"><p>If you think it its similar that the old cartoon animation process. Having the mouse drawn frame by frame and flipping them it quickly does the same trick.</p></div>
<div class="paragraph"><p>Enough of theory, lets do this in a practical way. Insert the following to the <strong>LayerViewController</strong> class:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">loadView</span>

  <span class="c1"># Lets create a view for our view controller</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="no">UIView</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithFrame</span><span class="p">(</span><span class="no">UIScreen</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

  <span class="n">layout_background_layer</span>
  <span class="n">layout_sun_layer</span>
  <span class="n">layout_grass_layer</span>

  <span class="c1"># Instantiate a gesture recognizer to handle the user touch</span>
  <span class="n">tap_gesture_recognizer</span> <span class="o">=</span> <span class="no">UITapGestureRecognizer</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithTarget</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span>
                                                                       <span class="n">action</span><span class="ss">:&#39;view_tap:&#39;</span><span class="p">)</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">addGestureRecognizer</span><span class="p">(</span><span class="n">tap_gesture_recognizer</span><span class="p">)</span>
<span class="k">end</span>


<span class="k">def</span> <span class="nf">view_tap</span><span class="p">(</span><span class="n">tap_gesture_recognizer</span><span class="p">)</span>

  <span class="c1">#Get the position of the touch according to the view</span>
  <span class="n">tap_point_in_view</span> <span class="o">=</span> <span class="n">tap_gesture_recognizer</span><span class="o">.</span><span class="n">locationInView</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="p">)</span>

  <span class="c1">#Apply the position to our Sun Layer</span>
  <span class="vi">@sun_layer</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">tap_point_in_view</span>

<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Now when you touch the screen the sun layer will animate to that particular position. Try another appearance changes or look again in the REPL part of the exercise.</p></div>
<div class="imageblock">
<div class="content">
<img src="resources/ch20-CALayers/ch20_AnimatedLayer.png" alt="Sun Layer" />
</div>
<div class="title">Figure 23. Animated Layer</div>
</div>
</div>
<div class="sect2">
<h3 id="_challenges_2">Challenges</h3>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
At the same time the sun layer is moving to a new position, rotate it like it was spinning. (HINT: CGTransformationMatrix)
</p>
</li>
<li>
<p>
Change the background of the application when the sun layer is on top, and on bottom. Like if it was sunrise, dawn and night
</p>
</li>
</ol></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Version 0.1<br />
Last updated 2012-11-06 16:41:47 CST
</div>
</div>
</body>
</html>
