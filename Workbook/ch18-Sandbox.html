<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.8" />
<title>Chapter 18 - Application Sandbox and Memory Warnings</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Helvetica,sans-serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: #880009;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: #880009;
}

strong {
  font-weight: bold;
  color: #880009;
}

h1, h2, h3, h4, h5, h6 {
  color: #880009;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1 {
  border-bottom: 1px solid #dddddd;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
  color: #666666;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #4f4f4f; }
ul > li > * { color: #666666; }

.monospaced, code, pre {
  font-family: Inconsolata;
  font-size: inherit;
  color: #4d4d4c;
  padding: 0;
  margin: 0;
}


#author {
  color: #880009;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
  color: #666666;
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
  color: #666666;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding:: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #4f4f4f;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1.5px solid #dddddd;
  background: #f4f4f4;
  padding: 0.5em;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  border-radius: 5px;
  font-family: Inconsolata;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #f2f2f2;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #666666;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
  color: #4f4f4f;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid red;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}

/*
  pygmentize filter
*/
.highlight .hll { border-left:solid 7px #880009; font-size:100%; font-family:Inconsolata; color:#4d4d4c;  }
.highlight  { background: #f4f4f4; font-family: Inconsolata; }
.highlight .c { color: #8e908c; font-style: italic; font-family: Inconsolata; } /* Comment */
.highlight .err { border: 1px solid #FF0000; font-family: Inconsolata; } /* Error */
.highlight .k { color: #8959a8; font-family: Inconsolata; } /* Keyword */
.highlight .o { color: #666666; font-family: Inconsolata; } /* Operator */

.highlight .cm { color: #8e908c; font-style: italic; font-family: Inconsolata; } /* Comment.Multiline */
.highlight .cp { color: #8e908c; font-family: Inconsolata; } /* Comment.Preproc */
.highlight .c1 { color: #8e908c; font-style: italic; font-family: Inconsolata; } /* Comment.Single */
.highlight .cs { color: #8e908c; font-weight: bold; font-family: Inconsolata; } /* Comment.Special */
.highlight .gd { color: #A00000; font-family: Inconsolata; } /* Generic.Deleted */
.highlight .ge { font-style: italic; font-family: Inconsolata; } /* Generic.Emph */
.highlight .gr { color: #FF0000; font-family: Inconsolata; } /* Generic.Error */

.highlight .gh { color: #000080; font-weight: bold; font-family: Inconsolata; } /* Generic.Heading */
.highlight .gi { color: #00A000; font-family: Inconsolata; } /* Generic.Inserted */
.highlight .go { color: #808080; font-family: Inconsolata; } /* Generic.Output */
.highlight .gp { color: #4d4d4c; font-weight: bold; font-family: Inconsolata; } /* Generic.Prompt */
.highlight .gs { font-weight: bold; font-family: Inconsolata; } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold; font-family: Inconsolata; } /* Generic.Subheading */
.highlight .gt { color: #800080; font-family: Inconsolata; } /* Generic.Traceback */


.highlight .kc { color: #8959a8; font-family: Inconsolata; } /* Keyword.Constant */
.highlight .kd { color: #8959a8; font-family: Inconsolata; } /* Keyword.Declaration */
.highlight .kn { color: #8959a8; font-family: Inconsolata; } /* Keyword.Namespace */
.highlight .kp { color: #8959a8; font-family: Inconsolata; } /* Keyword.Pseudo */
.highlight .kr { color: #8959a8; font-family: Inconsolata; } /* Keyword.Reserved */
.highlight .kt { color: #8959a8; font-family: Inconsolata; } /* Keyword.Type */


.highlight .m { color: #666666; font-family: Inconsolata; } /* Literal.Number */
.highlight .s { color: #BB4444; font-family: Inconsolata; } /* Literal.String */

.highlight .na { color: #BB4444; font-family: Inconsolata; } /* Name.Attribute */
.highlight .nb { color: #718c00; font-family: Inconsolata; } /* Name.Builtin */
.highlight .nc { color: #c82829; font-family: Inconsolata; } /* Name.Class */
.highlight .no { color: #c82829; font-family: Inconsolata; } /* Name.Constant */
.highlight .nd { color: #AA22FF; font-family: Inconsolata; } /* Name.Decorator */
.highlight .ni { color: #999999; font-family: Inconsolata; } /* Name.Entity */
.highlight .ne { color: #D2413A; font-family: Inconsolata; } /* Name.Exception */
.highlight .nf { color: #4271ae; font-family: Inconsolata; } /* Name.Function */
.highlight .nl { color: #A0A000; font-family: Inconsolata; } /* Name.Label */
.highlight .nn { color: #0000FF; font-family: Inconsolata; } /* Name.Namespace */
.highlight .nt { color: #008000; font-family: Inconsolata; } /* Name.Tag */
.highlight .nv { color: #4d4d4c; font-family: Inconsolata; } /* Name.Variable */
.highlight .bp { color: #AA22FF; font-family: Inconsolata; } /* Name.Builtin.Pseudo */
.highlight .vc { color: #4d4d4c; font-family: Inconsolata; } /* Name.Variable.Class */
.highlight .vg { color: #3e999f; font-family: Inconsolata; } /* Name.Variable.Global */
.highlight .vi { color: #3e999f; font-family: Inconsolata; } /* Name.Variable.Instance */


.highlight .ow { color: #f5871f; font-family: Inconsolata; } /* Operator.Word */
.highlight .w { color: #f5871f; font-family: Inconsolata; } /* Text.Whitespace */
.highlight .mf { color: #f5871f; font-family: Inconsolata; } /* Literal.Number.Float */
.highlight .mh { color: #f5871f; font-family: Inconsolata; } /* Literal.Number.Hex */
.highlight .mi { color: #f5871f; font-family: Inconsolata; } /* Literal.Number.Integer */
.highlight .mo { color: #f5871f; font-family: Inconsolata; } /* Literal.Number.Oct */
.highlight .sb { color: #f5871f; font-family: Inconsolata; } /* Literal.String.Backtick */
.highlight .sc { color: #f5871f; font-family: Inconsolata; } /* Literal.String.Char */
.highlight .sd { color: #f5871f; font-family: Inconsolata; } /* Literal.String.Doc */
.highlight .s2 { color: #f5871f; font-family: Inconsolata; } /* Literal.String.Double */
.highlight .se { color: #f5871f; font-family: Inconsolata; } /* Literal.String.Escape */
.highlight .sh { color: #f5871f; font-family: Inconsolata; } /* Literal.String.Heredoc */
.highlight .si { color: #f5871f; font-family: Inconsolata; } /* Literal.String.Interpol */
.highlight .sx { color: #f5871f; font-family: Inconsolata; } /* Literal.String.Other */
.highlight .sr { color: #f5871f; font-family: Inconsolata; } /* Literal.String.Regex */
.highlight .s1 { color: #f5871f; font-family: Inconsolata; } /* Literal.String.Single */
.highlight .ss { color: #f5871f; font-family: Inconsolata; } /* Literal.String.Symbol */


.highlight .il { color: #f5871f; font-family: Inconsolata; } /* Literal.Number.Integer.Long */


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Chapter 18 - Application Sandbox and Memory Warnings</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_file_system_structure">File System Structure</h2>
<div class="sectionbody">
<div class="paragraph"><p>We are going to learn in this chapter how to save our photos to disk, and when the application finish for any reason, the photos remains, have done say that which is the perfect place for store our files? Well we have more than one option, but for now we are going to use the application sandbox.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_application_sandbox">Application Sandbox</h2>
<div class="sectionbody">
<div class="paragraph"><p>An application sandbox its a directory enclosed and protected so no one ca access to it but the application itself. Inside of it we have the following directories:</p></div>
<div class="sect2">
<h3 id="_application_bundle">application bundle</h3>
<div class="paragraph"><p>This directory contains all the resources and the executable file and its read only</p></div>
</div>
<div class="sect2">
<h3 id="_library_preferences">Library/Preferences/</h3>
<div class="paragraph"><p>We have a directory in which store the preferences are saved, this directory is managed by the class <strong>NSUserDefaults</strong> and its backed up when the device synchronizes with iTunes or iCloud</p></div>
</div>
<div class="sect2">
<h3 id="_tmp">tmp/</h3>
<div class="paragraph"><p>You have a directory where you can can store temporal dat during run time and you are responsible for erase it when you are done with it, also the operating system may purge dat when the application its not running. An important think to remember its that this information its not backed up, you get access to this directory using, the function <strong>NSTemporaryDirectory</strong>.</p></div>
</div>
<div class="sect2">
<h3 id="_documents">Documents/</h3>
<div class="paragraph"><p>In this directory you can save store data that your application generates during run time and want to persist. This information its synchronized with iTunes or iCloud.</p></div>
</div>
<div class="sect2">
<h3 id="_library_caches">Library/Caches/</h3>
<div class="paragraph"><p>In essence it has the same functionality as documents directory, but its <strong>NOT</strong> synchronized or backed up, also this data can be deleted when the operating system requires the space, so you should have a mechanism to regenerate this info.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_photo_model">Photo Model</h2>
<div class="sectionbody">
<div class="paragraph"><p>We are going to create an object <em>photo</em> that takes the responsibility of code and decode the attributes of the photo, bring back the files from the previous chapter and add the the file named <strong>photo.rb</strong> to the app folder</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Photo</span>

  <span class="kp">attr_accessor</span> <span class="ss">:photoName</span>
  <span class="kp">attr_accessor</span> <span class="ss">:photoImage</span>

  <span class="k">def</span> <span class="nf">encodeWithCoder</span><span class="p">(</span><span class="n">encoder</span><span class="p">)</span>

    <span class="n">encoder</span><span class="o">.</span><span class="n">encodeObject</span><span class="p">(</span><span class="vi">@photoName</span><span class="p">,</span><span class="n">forKey</span><span class="ss">:&quot;photoName&quot;</span><span class="p">)</span>
    <span class="n">encoder</span><span class="o">.</span><span class="n">encodeObject</span><span class="p">(</span><span class="vi">@photoImage</span><span class="p">,</span><span class="n">forKey</span><span class="ss">:&quot;photoImage&quot;</span><span class="p">)</span>
  <span class="k">end</span>


  <span class="k">def</span> <span class="nf">initWithCoder</span><span class="p">(</span><span class="n">decoder</span><span class="p">)</span>

    <span class="vi">@photoName</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">decodeObjectForKey</span><span class="p">(</span><span class="s2">&quot;photoName&quot;</span><span class="p">)</span>
    <span class="vi">@photoImage</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">decodeObjectForKey</span><span class="p">(</span><span class="s2">&quot;photoImage&quot;</span><span class="p">)</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>You may wondering why do we need to <em>code</em> the attributes of the object, well its because we are going store the object in a binary format, in the documents directory.</p></div>
<div class="paragraph"><p>Once we set up our photo object, we are going to create another object that saves and retrieves photos from the library, now create a file named <strong>photo_library.rb</strong> and add the following code</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PhotoLibrary</span>

  <span class="kp">attr_accessor</span> <span class="ss">:photos</span>


  <span class="k">def</span> <span class="nf">photosArchivePath</span>

    <span class="n">documentDirectories</span> <span class="o">=</span> <span class="no">NSSearchPathForDirectoriesInDomains</span><span class="p">(</span><span class="no">NSDocumentDirectory</span><span class="p">,</span><span class="no">NSUserDomainMask</span><span class="p">,</span> <span class="kp">true</span><span class="p">)</span>
    <span class="c1">#Get one and only document directory from that list</span>
    <span class="n">documentDirectory</span> <span class="o">=</span> <span class="n">documentDirectories</span><span class="o">.</span><span class="n">objectAtIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">documentDirectory</span><span class="o">.</span><span class="n">stringByAppendingPathComponent</span><span class="p">(</span><span class="s2">&quot;photos.archive&quot;</span><span class="p">)</span>
  <span class="k">end</span>


  <span class="k">def</span> <span class="nf">saveChanges</span> <span class="p">(</span><span class="n">photo</span><span class="p">)</span>

    <span class="n">allPhotos</span> <span class="o">=</span> <span class="n">storedPhotos</span>
    <span class="n">allPhotos</span><span class="o">.</span><span class="n">addObject</span><span class="p">(</span><span class="n">photo</span><span class="p">)</span>
    <span class="vi">@photos</span> <span class="o">=</span> <span class="n">allPhotos</span>
    <span class="no">NSKeyedArchiver</span><span class="o">.</span><span class="n">archiveRootObject</span><span class="p">(</span><span class="vi">@photos</span> <span class="p">,</span> <span class="n">toFile</span><span class="ss">:photosArchivePath</span><span class="p">)</span>
  <span class="k">end</span>


  <span class="k">def</span> <span class="nf">storedPhotos</span>

    <span class="n">finalArray</span> <span class="o">=</span> <span class="no">NSKeyedUnarchiver</span><span class="o">.</span><span class="n">unarchiveObjectWithFile</span><span class="p">(</span><span class="n">photosArchivePath</span><span class="p">)</span>

    <span class="k">if</span> <span class="o">!</span><span class="n">finalArray</span>

      <span class="n">finalArray</span> <span class="o">=</span> <span class="no">NSMutableArray</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
    <span class="k">end</span>

    <span class="n">finalArray</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Now we should save photo once it have been taken, open the album_camera_view_controller.rb and add the following methods</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">savePhoto</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>

  <span class="nb">puts</span> <span class="s2">&quot;saving&quot;</span>

  <span class="n">library</span> <span class="o">=</span> <span class="no">PhotoLibrary</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>

  <span class="n">photoObject</span> <span class="o">=</span> <span class="no">Photo</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
  <span class="n">photoObject</span><span class="o">.</span><span class="n">photoName</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span>
  <span class="n">photoObject</span><span class="o">.</span><span class="n">photoImage</span> <span class="o">=</span> <span class="vi">@imageView</span><span class="o">.</span><span class="n">image</span>

  <span class="n">library</span><span class="o">.</span><span class="n">saveChanges</span><span class="p">(</span><span class="n">photoObject</span><span class="p">)</span>
<span class="k">end</span>


<span class="k">def</span> <span class="nf">setSaveButton</span>

  <span class="vi">@savebuttonWithImage</span> <span class="o">=</span> <span class="n">saveButtonItem</span>
  <span class="vi">@savebuttonWithImage</span><span class="o">.</span><span class="n">addTarget</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="ss">:&#39;savePhoto:&#39;</span><span class="p">,</span><span class="n">forControlEvents</span><span class="ss">:UIControlEventTouchUpInside</span><span class="p">)</span>
  <span class="n">barButton</span> <span class="o">=</span> <span class="no">UIBarButtonItem</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithCustomView</span><span class="p">(</span><span class="vi">@savebuttonWithImage</span><span class="p">)</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">navigationItem</span><span class="o">.</span><span class="n">rightBarButtonItem</span> <span class="o">=</span> <span class="n">barButton</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>The <em>menuButtonItem</em> should be created somewhere in this case in the <strong>album_utilities.rb</strong> so open the file and add the following method</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">saveButtonItem</span>

  <span class="n">buttonWithImage</span> <span class="o">=</span> <span class="no">UIButton</span><span class="o">.</span><span class="n">buttonWithType</span> <span class="no">UIButtonTypeCustom</span>
  <span class="n">buttonWithImage</span><span class="o">.</span><span class="n">setFrame</span> <span class="no">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">35</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">buttonWithImage</span><span class="o">.</span><span class="n">setImage</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span><span class="s2">&quot;sendEnabled&quot;</span><span class="p">),</span> <span class="n">forState</span><span class="ss">:UIControlStateSelected</span>
  <span class="n">buttonWithImage</span><span class="o">.</span><span class="n">setImage</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span><span class="s2">&quot;sendEnabled&quot;</span><span class="p">),</span> <span class="n">forState</span><span class="ss">:UIControlStateHighlighted</span>
  <span class="n">buttonWithImage</span><span class="o">.</span><span class="n">setImage</span> <span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span><span class="s2">&quot;sendDisabled&quot;</span><span class="p">),</span> <span class="n">forState</span><span class="ss">:UIControlStateNormal</span>
  <span class="n">buttonWithImage</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Run the application to make sure that everything it&#8217;s going well, now we can store photos, but we do not have a place to show them, wait a minute we have
<em>Photo Album</em>, we are saved !! we just need to set collection view <em>dataSource</em> to get the photos from the library, in order to do that open the <strong>album_collection_view_controller.rb</strong> file and replace the following methods</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">viewDidLoad</span>

  <span class="k">super</span><span class="p">()</span>
  <span class="c1"># Load the NIB file</span>
  <span class="n">nib</span> <span class="o">=</span> <span class="no">UINib</span><span class="o">.</span><span class="n">nibWithNibName</span><span class="p">(</span><span class="s1">&#39;PhotoCollectionCellView&#39;</span><span class="p">,</span> <span class="n">bundle</span><span class="ss">:nil</span><span class="p">)</span>
  <span class="c1"># Register this NIB which contains the cell</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">collectionView</span><span class="o">.</span><span class="n">registerNib</span><span class="p">(</span><span class="n">nib</span><span class="p">,</span> <span class="n">forCellWithReuseIdentifier</span><span class="ss">:&#39;PhotoCollectionCellView&#39;</span><span class="p">)</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">collectionView</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="no">UIColor</span><span class="o">.</span><span class="n">colorWithPatternImage</span><span class="p">(</span><span class="no">UIImage</span><span class="o">.</span><span class="n">imageNamed</span><span class="p">(</span><span class="s2">&quot;bgTile&quot;</span><span class="p">))</span>

  <span class="vi">@library</span> <span class="o">=</span> <span class="no">PhotoLibrary</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
<span class="k">end</span>


<span class="k">def</span> <span class="nf">phothos</span>

  <span class="n">photosArray</span> <span class="o">=</span> <span class="vi">@library</span><span class="o">.</span><span class="n">storedPhotos</span>
  <span class="n">photosArray</span>
<span class="k">end</span>


<span class="k">def</span> <span class="nf">collectionView</span><span class="p">(</span><span class="n">collectionView</span><span class="p">,</span> <span class="n">cellForItemAtIndexPath</span><span class="ss">:indexPath</span><span class="p">)</span>

  <span class="n">cell</span> <span class="o">=</span> <span class="n">collectionView</span><span class="o">.</span><span class="n">dequeueReusableCellWithReuseIdentifier</span><span class="p">(</span><span class="s1">&#39;PhotoCollectionCellView&#39;</span> <span class="p">,</span><span class="n">forIndexPath</span><span class="ss">:indexPath</span><span class="p">)</span>
  <span class="n">cell</span><span class="o">.</span><span class="n">customizeCollectionCell</span><span class="p">(</span><span class="n">phothos</span><span class="o">[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="o">]</span><span class="p">)</span>
  <span class="n">cell</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Also we have to create a method that refresh the content in the collectionView</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">updateCollectionView</span>

  <span class="nb">self</span><span class="o">.</span><span class="n">collectionView</span><span class="o">.</span><span class="n">reloadData</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>We should not forget to modify the custom cell to accept the object from the library, modify <strong>collection_view_cell.rb</strong> file and replace the <em>customizeCollectionCell</em> method</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">customizeCollectionCell</span><span class="p">(</span><span class="n">photo</span><span class="p">)</span>

  <span class="vi">@photoImageView</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">viewWithTag</span><span class="p">(</span><span class="no">CELL_IMAGE_VIEW</span><span class="p">)</span>
  <span class="vi">@photoImageView</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">photo</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>At last we need to modify the <strong>album_view_controller.rb</strong> file for reload the collection view</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="nf">loadCollectionView</span>

<span class="c1">#avoid to create the same instance of the controllers more than once</span>
  <span class="k">if</span> <span class="o">!</span><span class="vi">@photoCollectionViewControllerr</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="vi">@photoCollectionNavigationViewController</span>

    <span class="vi">@photoCollectionViewController</span> <span class="o">=</span> <span class="no">PhotoCollectionViewController</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">init</span>
    <span class="vi">@photoCollectionNavigationViewController</span> <span class="o">=</span> <span class="no">UINavigationController</span><span class="o">.</span><span class="n">alloc</span><span class="o">.</span><span class="n">initWithRootViewController</span><span class="p">(</span><span class="vi">@photoCollectionViewController</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="vi">@photoCollectionNavigationViewController</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">bounds</span>
  <span class="n">view</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="vi">@photoCollectionNavigationViewController</span><span class="o">.</span><span class="n">view</span><span class="p">)</span>
  <span class="vi">@photoCollectionViewController</span><span class="o">.</span><span class="n">updateCollectionView</span>

  <span class="c1">#set the current section</span>
  <span class="vi">@selectedRows</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="vi">@currentSection</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Now once that you take a photo press the save button and you will be able to see it on the album view</p></div>
<div class="imageblock">
<div class="content">
<img src="Resources/ch18-Sandbox/image1.png" alt="Save Photo" />
</div>
<div class="title">Figure 1. Save Photo</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Resources/ch18-Sandbox/image2.png" alt="Photo Added" />
</div>
<div class="title">Figure 2. Photo Added</div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2012-12-05 21:40:05 CST
</div>
</div>
</body>
</html>
